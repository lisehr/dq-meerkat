(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{Z209:function(e,t,r){"use strict";r.r(t);var n=r("KHwQ"),a=r.n(n),i=r("txxJ"),o=r("LvDl"),s=r.n(o);var u=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.init=function(){var e=t.target;e.namespace=e.namespace||"",e.metricName=e.metricName||"",e.statistics=e.statistics||["Average"],e.dimensions=e.dimensions||{},e.period=e.period||"",e.region=e.region||"default",e.id=e.id||"",e.expression=e.expression||"",t.regionSegment=n.getSegmentForValue(t.target.region,"select region"),t.namespaceSegment=n.getSegmentForValue(t.target.namespace,"select namespace"),t.metricSegment=n.getSegmentForValue(t.target.metricName,"select metric"),t.dimSegments=s.a.reduce(t.target.dimensions,(function(e,t,r){return e.push(n.newKey(r)),e.push(n.newOperator("=")),e.push(n.newKeyValue(t)),e}),[]),t.statSegments=s.a.map(t.target.statistics,(function(e){return n.getSegmentForValue(e)})),t.ensurePlusButton(t.statSegments),t.ensurePlusButton(t.dimSegments),t.removeDimSegment=n.newSegment({fake:!0,value:"-- remove dimension --"}),t.removeStatSegment=n.newSegment({fake:!0,value:"-- remove stat --"}),s.a.isEmpty(t.target.region)&&(t.target.region="default"),t.onChange||(t.onChange=function(){})},t.getStatSegments=function(){return Promise.resolve(s.a.flatten([a.a.copy(t.removeStatSegment),s.a.map(t.datasource.standardStatistics,(function(e){return n.getSegmentForValue(e)})),n.getSegmentForValue("pNN.NN")]))},t.statSegmentChanged=function(e,r){e.value===t.removeStatSegment.value?t.statSegments.splice(r,1):e.type="value",t.target.statistics=s.a.reduce(t.statSegments,(function(e,t){return t.fake||e.push(t.value),e}),[]),t.ensurePlusButton(t.statSegments),t.onChange()},t.ensurePlusButton=function(e){var t=e.length,r=e[Math.max(t-1,0)];r&&"plus-button"===r.type||e.push(n.newPlusButton())},t.getDimSegments=function(e,r){if("operator"===e.type)return Promise.resolve([]);var n=t.target,i=Promise.resolve([]);if("key"===e.type||"plus-button"===e.type)i=t.datasource.getDimensionKeys(t.target.namespace,t.target.region);else if("value"===e.type){var o=t.dimSegments[r-2].value;delete n.dimensions[o],i=t.datasource.getDimensionValues(n.region,n.namespace,n.metricName,o,n.dimensions)}return i.then(t.transformToSegments(!0)).then((function(r){return"key"===e.type&&r.splice(0,0,a.a.copy(t.removeDimSegment)),r}))},t.dimSegmentChanged=function(e,r){t.dimSegments[r]=e,e.value===t.removeDimSegment.value?t.dimSegments.splice(r,3):"plus-button"===e.type&&(t.dimSegments.push(n.newOperator("=")),t.dimSegments.push(n.newFake("select dimension value","value","query-segment-value")),e.type="key",e.cssClass="query-segment-key"),t.syncDimSegmentsWithModel(),t.ensurePlusButton(t.dimSegments),t.onChange()},t.syncDimSegmentsWithModel=function(){for(var e={},r=t.dimSegments.length,n=0;n<r-2;n+=3){var a=t.dimSegments[n],i=t.dimSegments[n+2];i.fake||(e[a.value]=i.value)}t.target.dimensions=e},t.getRegions=function(){return t.datasource.metricFindQuery("regions()").then((function(e){return e.unshift({text:"default"}),e})).then(t.transformToSegments(!0))},t.getNamespaces=function(){return t.datasource.metricFindQuery("namespaces()").then(t.transformToSegments(!0))},t.getMetrics=function(){return t.datasource.metricFindQuery("metrics("+t.target.namespace+","+t.target.region+")").then(t.transformToSegments(!0))},t.regionChanged=function(){t.target.region=t.regionSegment.value,t.onChange()},t.namespaceChanged=function(){t.target.namespace=t.namespaceSegment.value,t.onChange()},t.metricChanged=function(){t.target.metricName=t.metricSegment.value,t.onChange()},t.transformToSegments=function(e){return function(t){var a=s.a.map(t,(function(e){return n.newSegment({value:e.text,expandable:e.expandable})}));return e&&s.a.each(r.getVariables(),(function(e){a.unshift(n.newSegment({type:"template",value:"$"+e.name,expandable:!0}))})),a}},t.init()};u.$inject=["$scope","templateSrv","uiSegmentSrv"],u.$inject=["$scope","templateSrv","uiSegmentSrv"],i.c.directive("cloudwatchQueryParameter",(function(){return{templateUrl:"public/app/plugins/datasource/cloudwatch/partials/query.parameter.html",controller:u,restrict:"E",scope:{target:"=",datasource:"=",onChange:"&"}}}));var c=r("Obii"),l=r("q1tI"),p=r.n(l),f=r("kDLi"),m=r("2Ie6"),d=r("WnbS"),g=r("iODs"),v=r("3SGO"),y=r("UvM7");function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var S,x=r("F/XL"),w=r("p0ib"),k=r("909l"),O=r("XlPw"),R=r("6blF"),j=r("psW0"),C=r("VnD/"),A=r("67Y/"),E=r("9Z1F"),P=r("Phjn"),I=r("Nzu2"),N=r("S1nX"),q=r("dC0D"),T=r("xMyE"),M=r("jvbL"),D=r("2WpN"),F=r("t8hP"),L=r("GQ3c"),Q=r("5kRJ"),_=r("NPB1"),V=function(e){var t=e.region;return p.a.createElement("p",null,"Please visit the ",p.a.createElement("a",{target:"_blank",rel:"noreferrer",className:"text-link",href:"https://".concat(t,".console.aws.amazon.com/servicequotas/home?region=").concat(t,"#!/services/monitoring/quotas/L-5E141212")},"AWS Service Quotas console")," to request a quota increase or see our ",p.a.createElement("a",{target:"_blank",rel:"noreferrer",className:"text-link",href:"https://grafana.com/docs/grafana/latest/datasources/cloudwatch/#service-quotas"},"documentation")," to learn more.")},G=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7e3,r=Object(o.memoize)((function(){return Object(o.debounce)(e,t,{leading:!0})}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return JSON.stringify(t)}));return function(){return r.apply(void 0,arguments).apply(void 0,arguments)}};!function(e){e.Scheduled="Scheduled",e.Running="Running",e.Complete="Complete",e.Failed="Failed",e.Cancelled="Cancelled",e.Timeout="Timeout"}(S||(S={}));var B=r("bnqK"),W=r("wZee"),U=r.n(W);function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function J(e,t,r,n,a,i,o){try{var s=e[i](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,a)}function $(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){J(i,n,a,o,s,"next",e)}function s(e){J(i,n,a,o,s,"throw",e)}o(void 0)}))}}function Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ee=function(e){function t(e,r){var n,a,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,i=H(t).call(this),(n=!i||"object"!==K(i)&&"function"!=typeof i?X(a):i).cleanText=function(e){return e.replace(/[()]/g,"").trim()},n.request=function(e,t){return n.datasource.awsRequest(e,t).toPromise()},n.start=function(){return n.startTask||(n.startTask=Promise.resolve().then((function(){return n.started=!0,[]}))),n.startTask},n.fetchFields=function(){var e=$(regeneratorRuntime.mark((function e(t){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.fetchedFieldsCache&&Date.now()-n.fetchedFieldsCache.time<3e4&&s.a.sortedUniq(n.fetchedFieldsCache.logGroups).join("|")===s.a.sortedUniq(t).join("|"))){e.next=2;break}return e.abrupt("return",n.fetchedFieldsCache.fields);case 2:return e.next=4,Promise.all(t.map((function(e){return n.datasource.getLogGroupFields({logGroupName:e})})));case 4:return r=e.sent,a=z(new Set(r.reduce((function(e,t){var r;return e.concat(null===(r=t.logGroupFields)||void 0===r?void 0:r.map((function(e){return e.name})))}),[])).values()),n.fetchedFieldsCache={time:Date.now(),logGroups:t,fields:a},e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleKeyword=function(){var e=$(regeneratorRuntime.mark((function e(t){var r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getFieldCompletionItems(null!==(r=null==t?void 0:t.logGroupNames)&&void 0!==r?r:[]);case 2:return i=e.sent,o=[{prefixMatch:!0,label:"Functions",items:B.h.concat(B.c,B.e)}],(a=i.suggestions).push.apply(a,o),e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleCommand=function(){var e=$(regeneratorRuntime.mark((function e(t,r,a){var i,o,s,u,c,l,p,f,m,d,g,v,y,h,b,S,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.content.toLowerCase(),s=re(r),u=s===t,"sort"!==o){e.next=5;break}return e.abrupt("return",n.handleSortCommand(u,r,a));case 5:if("parse"!==o){e.next=10;break}if(!u){e.next=10;break}return e.next=9,n.getFieldCompletionItems(null!==(c=null==a?void 0:a.logGroupNames)&&void 0!==c?c:[]);case 9:return e.abrupt("return",e.sent);case 10:if(l=se(t.next,"whitespace")&&!(null===(i=t.next)||void 0===i?void 0:i.next),p=l||te(t)===r,f=se(r,"punctuation",","),m=f||se(s,"punctuation",","),p||m){e.next=16;break}return e.abrupt("return",{suggestions:[]});case 16:if(!["display","fields"].includes(o)){e.next=22;break}return e.next=19,n.getFieldCompletionItems(null!==(d=null==a?void 0:a.logGroupNames)&&void 0!==d?d:[]);case 19:return v=e.sent,(g=v.suggestions).push.apply(g,z(n.getFieldAndFilterFunctionCompletionItems().suggestions)),e.abrupt("return",v);case 22:if("stats"!==o){e.next=26;break}return y=n.getStatsAggCompletionItems(),(f||l)&&(null==y||y.suggestions.forEach((function(e){e.skipFilter=!0}))),e.abrupt("return",y);case 26:if("filter"!==o||!u){e.next=33;break}return e.next=29,n.getFieldCompletionItems(null!==(h=null==a?void 0:a.logGroupNames)&&void 0!==h?h:[]);case 29:return S=e.sent,x=n.getBoolFuncCompletionItems(),(b=S.suggestions).push.apply(b,z(x.suggestions)),e.abrupt("return",S);case 33:return e.abrupt("return",{suggestions:[]});case 34:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),n.handleComparison=function(){var e=$(regeneratorRuntime.mark((function e(t){var r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getFieldCompletionItems(null!==(r=null==t?void 0:t.logGroupNames)&&void 0!==r?r:[]);case 2:return i=e.sent,o=n.getComparisonCompletionItems(),(a=i.suggestions).push.apply(a,z(o.suggestions)),e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.getCommandCompletionItems=function(){return{suggestions:[{prefixMatch:!0,label:"Commands",items:B.g}]}},n.getFieldAndFilterFunctionCompletionItems=function(){return{suggestions:[{prefixMatch:!0,label:"Functions",items:B.d}]}},n.getStatsAggCompletionItems=function(){return{suggestions:[{prefixMatch:!0,label:"Functions",items:B.a}]}},n.getBoolFuncCompletionItems=function(){return{suggestions:[{prefixMatch:!0,label:"Functions",items:B.b}]}},n.getComparisonCompletionItems=function(){return{suggestions:[{prefixMatch:!0,label:"Functions",items:B.f.concat(B.b)}]}},n.getFieldCompletionItems=function(){var e=$(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.fetchFields(t);case 2:return r=e.sent,e.abrupt("return",{suggestions:[{label:"Fields",items:r.map((function(e){return{label:e,insertText:e.match(/@?[_a-zA-Z]+[_.0-9a-zA-Z]*/)?void 0:"`".concat(e,"`")}}))}]});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.datasource=e,Object.assign(X(n),r),n}var r,n,a,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(t,e),r=t,(n=[{key:"getSyntax",value:function(){return B.i}},{key:"isStatsQuery",value:function(e){var t,r=this.getSyntax();return!!(null!==(t=U.a.tokenize(e,r))&&void 0!==t?t:[]).find((function(e){return"string"!=typeof e&&"stats"===e.content.toString().toLowerCase()&&"query-command"===e.type}))}},{key:"provideCompletionItems",value:(o=$(regeneratorRuntime.mark((function e(t,r){var n,a,i,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.value,(a=null==n?void 0:n.data.get("tokens"))&&a.length){e.next=4;break}return e.abrupt("return",{suggestions:[]});case 4:if(i=a.filter((function(e){var t,r,a,i;return e.offsets.start<=(null===(t=n.selection)||void 0===t||null===(r=t.start)||void 0===r?void 0:r.offset)&&e.offsets.end>=(null===(a=n.selection)||void 0===a||null===(i=a.start)||void 0===i?void 0:i.offset)}))[0],o=!i.prev,s=re(i),!(o||!o&&(null==s?void 0:s.types.includes("command-separator")))){e.next=10;break}return e.abrupt("return",this.getCommandCompletionItems());case 10:if(!ie(i)){e.next=14;break}return e.next=13,this.getFieldCompletionItems(null!==(u=null==r?void 0:r.logGroupNames)&&void 0!==u?u:[]);case 13:return e.abrupt("return",e.sent);case 14:if(!oe("by",i)){e.next=16;break}return e.abrupt("return",this.handleKeyword(r));case 16:if(!(null==s?void 0:s.types.includes("comparison-operator"))){e.next=18;break}return e.abrupt("return",this.handleComparison(r));case 18:if(!(c=ne(i))){e.next=23;break}return e.next=22,this.handleCommand(c,i,r);case 22:return e.abrupt("return",e.sent);case 23:return e.abrupt("return",{suggestions:[]});case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"handleSortCommand",value:(i=$(regeneratorRuntime.mark((function e(t,r,n){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,this.getFieldCompletionItems(null!==(a=null==n?void 0:n.logGroupNames)&&void 0!==a?a:[]);case 3:return e.abrupt("return",e.sent);case 6:if(!se(re(r),"field-name")){e.next=8;break}return e.abrupt("return",{suggestions:[{prefixMatch:!0,label:"Sort Order",items:[{label:"asc"},{label:"desc"}]}]});case 8:return e.abrupt("return",{suggestions:[]});case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return i.apply(this,arguments)})}])&&Z(r.prototype,n),a&&Z(r,a),t}(c.LanguageProvider);function te(e){for(var t=e;t.next;){if(!t.next.types.includes("whitespace"))return t.next;t=t.next}return null}function re(e){for(var t=e;t.prev;){if(!se(t.prev,"whitespace"))return t.prev;t=t.prev}return null}function ne(e){for(var t=e;t.prev;)if((t=t.prev).types.includes("query-command")&&(!t.prev||se(re(t),"command-separator")))return t;return null}var ae=["avg","count","count_distinct","earliest","latest","sortsFirst","sortsLast","max","min","pct","stddev","ispresent","fromMillis","toMillis","isempty","isblank","isValidIp","isValidIpV4","isValidIpV6","isIpInSubnet","isIpv4InSubnet","isIpv6InSubnet"].map((function(e){return e.toLowerCase()}));function ie(e){var t=re(e);if(!t)return!1;var r="("===e.content?e:"("===t.content?t:void 0;if(r){var n=re(r);if(n)return ae.includes(n.content.toLowerCase())&&n.types.includes("function")}return!1}function oe(e,t){var r=ue(t,["whitespace","function","punctuation","field-name","number"]);if(se(r,"keyword","by")){var n=ue(t,["whitespace"]);if(n===r||se(n,"punctuation",","))return!0}return!1}function se(e,t,r){return!!(null==e?void 0:e.types.includes(t))&&(!r||(null==e?void 0:e.content.toLowerCase())===r)}function ue(e,t){var r=e.prev;e:for(;r;){var n=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if("string"==typeof u){if(r.types.includes(u)){r=r.prev;continue e}}else if(r.types.includes(u.type)&&r.content.toLowerCase()===u.value){r=r.prev;continue e}}}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}break}return r}var ce=r("R37w"),le=r("T1DM");function pe(e){var t=e.subscriber,r=e.counter,n=e.period,a=e.step,i=e.endPeriod;t.next(r);var o=Math.min(n+a,i);this.schedule({subscriber:t,counter:r+1,period:o,step:a,endPeriod:i},o)}var fe=r("ZFWI");function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function de(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ve(e,t,r,n,a,i,o){try{var s=e[i](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,a)}function ye(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){ve(i,n,a,o,s,"next",e)}function s(e){ve(i,n,a,o,s,"throw",e)}o(void 0)}))}}function he(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?he(Object(r),!0).forEach((function(t){Se(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Se(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function we(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ke(e,t){return!t||"object"!==me(t)&&"function"!=typeof t?Re(e):t}function Oe(e){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function je(e,t){return(je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ce=function(e,t){return g.d.dispatch(Object(v.b)(Object(y.a)("CloudWatch request limit reached in ".concat(t," for data source ").concat(e),"",p.a.createElement(V,{region:t},null))))},Ae=function(e,t){return g.d.dispatch(Object(v.b)(Object(y.a)(e,t)))},Ee=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(Q.a)(),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(_.a)();return xe(this,t),(r=ke(this,Oe(t).call(this,e))).templateSrv=n,r.timeSrv=a,r.type="cloudwatch",r.standardStatistics=["Average","Maximum","Minimum","Sum","SampleCount"],r.debouncedAlert=G(Ce,L.AppNotificationTimeout.Error),r.debouncedCustomAlert=G(Ae,L.AppNotificationTimeout.Error),r.logQueries={},r.handleLiveLogQueries=function(e,t){var n=e.filter((function(e){var t;return null===(t=e.logGroupNames)||void 0===t?void 0:t.length}));if(e.length>n.length)return Object(x.a)({data:[],error:{message:"Log group is required"}});if(s.a.isEmpty(n))return Object(x.a)({data:[],state:c.LoadingState.Done});var a=n.map((function(e){var n;return{intervalMs:1,maxDataPoints:1,datasourceId:r.id,queryString:r.replace(e.expression,t.scopedVars,!0),refId:e.refId,logGroupNames:null===(n=e.logGroupNames)||void 0===n?void 0:n.map((function(e){return r.replace(e,t.scopedVars,!0,"log groups")})),statsGroups:e.statsGroups,region:r.getActualRegion(r.replace(e.region,t.scopedVars,!0,"region")),type:"liveLogAction"}})),i=r.timeSrv.timeRange(),o={from:i.from.valueOf().toString(),to:i.to.valueOf().toString(),queries:a};return r.awsRequest("/api/tsdb/query",o).pipe(Object(j.b)((function(e){var t=e.results.A.meta.channelName;return Object(F.getGrafanaLiveSrv)().getChannel({scope:c.LiveChannelScope.Plugin,namespace:"cloudwatch",path:t}).getStream()})),Object(C.a)((function(e){return"message"===e.type})),Object(A.a)((function(e){var n=e.message,a=Object(F.toDataQueryResponse)({data:n});return a.state=a.data.every((function(e){var t,r;return Ie(null===(t=e.meta)||void 0===t||null===(r=t.custom)||void 0===r?void 0:r.Status)}))?c.LoadingState.Done:c.LoadingState.Loading,a.key=n.results[Object.keys(n.results)[0]].refId,r.addDataLinksToLogsResponse(a,t)})),Object(E.a)((function(e){var t;if(null===(t=e.data)||void 0===t?void 0:t.error)throw e.data.error;throw e})))},r.handleLogQueries=function(e,t){var n=e.filter((function(e){var t;return null===(t=e.logGroupNames)||void 0===t?void 0:t.length}));if(e.length>n.length)return Object(x.a)({data:[],error:{message:"Log group is required"}});if(s.a.isEmpty(n))return Object(x.a)({data:[],state:c.LoadingState.Done});var a=n.map((function(e){return{queryString:e.expression,refId:e.refId,logGroupNames:e.logGroupNames,region:r.replace(r.getActualRegion(e.region),t.scopedVars,!0,"region")}}));return r.makeLogActionRequest("StartQuery",a,t.scopedVars).pipe(Object(j.b)((function(t){return r.logsQuery(t.map((function(t){var r,n,a;return{queryId:t.fields[0].values.get(0),region:null!==(r=null===(n=t.meta)||void 0===n||null===(a=n.custom)||void 0===a?void 0:a.Region)&&void 0!==r?r:"default",refId:t.refId,statsGroups:e.find((function(e){return e.refId===t.refId})).statsGroups}})))})),Object(A.a)((function(e){return r.addDataLinksToLogsResponse(e,t)})))},r.handleMetricQueries=function(e,t){var n,a,i=e.filter((function(e){var t;return!!e.region&&!!e.namespace&&!!e.metricName&&!s.a.isEmpty(e.statistics)||(null===(t=e.expression)||void 0===t?void 0:t.length)>0})).map((function(e){if(e.region=r.replace(r.getActualRegion(e.region),t.scopedVars,!0,"region"),e.namespace=r.replace(e.namespace,t.scopedVars,!0,"namespace"),e.metricName=r.replace(e.metricName,t.scopedVars,!0,"metric name"),e.dimensions=r.convertDimensionFormat(e.dimensions,t.scopedVars),e.statistics=e.statistics.map((function(e){return r.replace(e,t.scopedVars,!0,"statistics")})),e.period=String(r.getPeriod(e,t)),e.id=r.templateSrv.replace(e.id,t.scopedVars),e.expression=r.templateSrv.replace(e.expression,t.scopedVars),e.statistics.some((function(e){if(0===e.indexOf("p")){var t=/^p\d{2}(?:\.\d{1,2})?$/.exec(e);return!t||t[0]!==e}return!1})))throw{message:"Invalid extended statistics"};return be({intervalMs:t.intervalMs,maxDataPoints:t.maxDataPoints,datasourceId:r.id,type:"timeSeriesQuery"},e)}));if(s.a.isEmpty(i))return Object(x.a)({data:[]});var o={from:null==t||null===(n=t.range)||void 0===n?void 0:n.from.valueOf().toString(),to:null==t||null===(a=t.range)||void 0===a?void 0:a.to.valueOf().toString(),queries:i};return r.performTimeSeriesQuery(o,t.range)},r.getLogRowContext=function(){var e=ye(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,u,c,l,p,f,m,d,g,v,y,h=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=h.length>1&&void 0!==h[1]?h[1]:{},a=n.limit,i=void 0===a?10:a,o=n.direction,s=void 0===o?"BACKWARD":o,u=null,c=null,l=!0,p=!1,f=void 0,e.prev=6,m=t.dataFrame.fields[Symbol.iterator]();case 8:if(l=(d=m.next()).done){e.next=23;break}if("__logstream__grafana_internal__"!==(g=d.value).name){e.next=16;break}if(u=g,null===c){e.next=14;break}return e.abrupt("break",23);case 14:e.next=20;break;case 16:if("__log__grafana_internal__"!==g.name){e.next=20;break}if(c=g,null===u){e.next=20;break}return e.abrupt("break",23);case 20:l=!0,e.next=8;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(6),p=!0,f=e.t0;case 29:e.prev=29,e.prev=30,l||null==m.return||m.return();case 32:if(e.prev=32,!p){e.next=35;break}throw f;case 35:return e.finish(32);case 36:return e.finish(29);case 37:return v={limit:i,startFromHead:"BACKWARD"!==s,logGroupName:Pe(c.values.get(t.rowIndex)),logStreamName:u.values.get(t.rowIndex)},"BACKWARD"===s?v.endTime=t.timeEpochMs:v.startTime=t.timeEpochMs,e.next=41,r.makeLogActionRequest("GetLogEvents",[v]).toPromise();case 41:return y=e.sent,e.abrupt("return",{data:y});case 43:case"end":return e.stop()}}),e,null,[[6,25,29,37],[30,,32,36]])})));return function(t){return e.apply(this,arguments)}}(),r.getTargetsByQueryMode=function(e){var t=[],r=[];return e.forEach((function(e){var n;"Logs"===(null!==(n=e.queryMode)&&void 0!==n?n:"Metrics")?t.push(e):r.push(e)})),{logQueries:t,metricsQueries:r}},r.proxyUrl=e.url,r.defaultRegion=e.jsonData.defaultRegion,r.datasourceName=e.name,r.languageProvider=new ee(Re(r)),r}var r,n,i,o,u,l,p,f,m;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&je(e,t)}(t,e),r=t,(n=[{key:"query",value:function(e){var t=(e=a.a.copy(e)).targets.filter((function(e){return""!==e.id||!0!==e.hide})),r=this.getTargetsByQueryMode(t),n=r.logQueries,i=r.metricsQueries,o=[];return n.length>0&&(fe.b.featureToggles.live?o.push(this.handleLiveLogQueries(n,e)):o.push(this.handleLogQueries(n,e))),i.length>0&&o.push(this.handleMetricQueries(i,e)),s.a.isEmpty(o)?Object(x.a)({data:[],state:c.LoadingState.Done}):w.a.apply(void 0,o)}},{key:"logsQuery",value:function(e){var t=this;this.logQueries={},e.forEach((function(e){var r,n,a;t.logQueries[e.refId]={id:e.queryId,region:e.region,statsQuery:null!==(r=(null!==(n=null===(a=e.statsGroups)||void 0===a?void 0:a.length)&&void 0!==n?n:0)>0)&&void 0!==r&&r}}));var r,n,a=function(e){var t=e.startPeriod,r=void 0===t?0:t,n=e.endPeriod,a=void 0===n?5e3:n,i=e.step,o=void 0===i?1e3:i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:le.b;return new R.a((function(e){return e.add(s.schedule(pe,r,{subscriber:e,counter:0,period:r,step:o,endPeriod:a})),e}))}({startPeriod:100,endPeriod:1e3,step:300}).pipe(Object(P.a)((function(r){return t.makeLogActionRequest("GetQueryResults",e)})),Object(I.a)(),Object(N.a)()),i=a.pipe(Object(q.a)((function(e,t){var r=e.failures,n=e.prevRecordsMatched;r++;var a=!0,i=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(a=(s=u.next()).done);a=!0){var c,l,p,f,m=s.value,d=null===(c=m.meta)||void 0===c||null===(l=c.stats)||void 0===l||null===(p=l.find((function(e){return"Records scanned"===e.displayName})))||void 0===p?void 0:p.value;d>(null!==(f=n[m.refId])&&void 0!==f?f:0)&&(r=0),n[m.refId]=d}}catch(e){i=!0,o=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw o}}return{failures:r,prevRecordsMatched:n}}),{failures:0,prevRecordsMatched:{}}),Object(A.a)((function(e){return e.failures})),Object(N.a)()),o=Object(k.b)(a,i).pipe(Object(T.a)((function(e){var r=ge(e,1)[0],n=!0,a=!1,i=void 0;try{for(var o,s=r[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u,c,l=o.value;[S.Complete,S.Cancelled,S.Failed].includes(null===(u=l.meta)||void 0===u||null===(c=u.custom)||void 0===c?void 0:c.Status)&&t.logQueries.hasOwnProperty(l.refId)&&delete t.logQueries[l.refId]}}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}})),Object(A.a)((function(e){var t=ge(e,2),r=t[0],n=t[1];if(n>=5){var a=!0,i=!1,o=void 0;try{for(var u,l=r[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var p=u.value;s.a.set(p,"meta.custom.Status",S.Cancelled)}}catch(e){i=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}}return{data:r,key:"test-key",state:r.every((function(e){var t,r;return[S.Complete,S.Cancelled,S.Failed].includes(null===(t=e.meta)||void 0===t||null===(r=t.custom)||void 0===r?void 0:r.Status)}))?c.LoadingState.Done:c.LoadingState.Loading,error:n>=5?{message:"error: query timed out after ".concat(5," attempts"),type:c.DataQueryErrorType.Timeout}:void 0}})),Object(M.a)((function(e){var t=e.state;return t!==c.LoadingState.Error&&t!==c.LoadingState.Done}),!0));return r=o,n=function(){return t.stopQueries()},new R.a((function(e){var t=r.subscribe({next:function(t){return e.next(t)},error:function(t){return e.next(t)},complete:function(){return e.complete()}});return function(){t.unsubscribe(),n()}}))}},{key:"addDataLinksToLogsResponse",value:function(e,t){var r=this,n=!0,a=!1,i=void 0;try{for(var o,s=function(){var e,n,a=o.value,i=r.timeSrv.timeRange(),s=i.from.toISOString(),u=i.to.toISOString(),c=t.targets.find((function(e){return e.refId===a.refId})),l=null!==(e=null===(n=c.logGroupNames)||void 0===n?void 0:n.map((function(e){return r.replace(e,t.scopedVars,!0,"log groups")})))&&void 0!==e?e:[],p={end:u,start:s,timeType:"ABSOLUTE",tz:"UTC",editorString:c.expression?r.replace(c.expression,t.scopedVars,!0):"",isLiveTail:!1,source:l},f=Object(ce.a)(p,r.getActualRegion(r.replace(c.region,t.scopedVars,!0,"region"))),m=!0,d=!1,g=void 0;try{for(var v,y=a.fields[Symbol.iterator]();!(m=(v=y.next()).done);m=!0)v.value.config.links=[{url:f,title:"View in CloudWatch console",targetBlank:!0}]}catch(e){d=!0,g=e}finally{try{m||null==y.return||y.return()}finally{if(d)throw g}}},u=e.data[Symbol.iterator]();!(n=(o=u.next()).done);n=!0)s()}catch(e){a=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw i}}return e}},{key:"stopQueries",value:function(){var e=this;Object.keys(this.logQueries).length>0&&this.makeLogActionRequest("StopQuery",Object.values(this.logQueries).map((function(e){return{queryId:e.id,region:e.region}})),void 0,!1).pipe(Object(D.a)((function(){e.logQueries={}})))}},{key:"describeLogGroups",value:(m=ye(regeneratorRuntime.mark((function e(t){var r,n,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeLogActionRequest("DescribeLogGroups",[t]).toPromise();case 2:return i=e.sent,o=null!==(r=null===(n=i[0])||void 0===n||null===(a=n.fields[0])||void 0===a?void 0:a.values.toArray())&&void 0!==r?r:[],e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getLogGroupFields",value:(f=ye(regeneratorRuntime.mark((function e(t){var r,n,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeLogActionRequest("GetLogGroupFields",[t]).toPromise();case 2:return n=e.sent,a=n[0].fields[0].values.toArray(),i=n[0].fields[1].values.toArray(),o={logGroupFields:null!==(r=a.map((function(e,t){return{name:e,percent:i[t]}})))&&void 0!==r?r:[]},e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"getVariables",value:function(){return this.templateSrv.getVariables().map((function(e){return"$".concat(e.name)}))}},{key:"getPeriod",value:function(e,t){var r=this.templateSrv.replace(e.period,t.scopedVars);return r&&"auto"!==r.toLowerCase()&&(r=/^\d+$/.test(r)?parseInt(r,10):c.rangeUtil.intervalToSeconds(r))<1&&(r=1),r||""}},{key:"performTimeSeriesQuery",value:function(e,t){var r=this;return t.from,t.to,this.awsRequest("/api/tsdb/query",e).pipe(Object(A.a)((function(e){var t=Object(F.toDataQueryResponse)({data:e}).data;return!t||t.length<=0?{data:[]}:{data:t,error:Object.values(e.results).reduce((function(e,t){return t.error?{message:t.error}:e}),null)}})),Object(E.a)((function(t){if(/^Throttling:.*/.test(t.data.message)){var n=Object.keys(t.data.results);Object.values(e.queries).reduce((function(e,t){var r=t.refId,a=t.region;return r&&!n.includes(r)||e.includes(a)?e:[].concat(de(e),[a])}),[]).forEach((function(e){return r.debouncedAlert(r.datasourceName,r.getActualRegion(e))}))}return t.data&&"Metric request error"===t.data.message&&t.data.error&&(t.data.message=t.data.error),Object(O.a)(t)})))}},{key:"transformSuggestDataFromTable",value:function(e){return e.results.metricFindQuery.tables[0].rows.map((function(e){var t=ge(e,2),r=t[0],n=t[1];return{text:r,value:n,label:n}}))}},{key:"doMetricQueryRequest",value:function(e,t){var r=this,n=this.timeSrv.timeRange();return this.awsRequest("/api/tsdb/query",{from:n.from.valueOf().toString(),to:n.to.valueOf().toString(),queries:[be({refId:"metricFindQuery",intervalMs:1,maxDataPoints:1,datasourceId:this.id,type:"metricFindQuery",subtype:e},t)]}).pipe(Object(A.a)((function(e){return r.transformSuggestDataFromTable(e)}))).toPromise()}},{key:"makeLogActionRequest",value:function(e,t,r){var n=this,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this.timeSrv.timeRange(),o={from:i.from.valueOf().toString(),to:i.to.valueOf().toString(),queries:t.map((function(t){return be({refId:"A",intervalMs:1,maxDataPoints:1,datasourceId:n.id,type:"logAction",subtype:e},t)}))};a&&o.queries.forEach((function(e){e.hasOwnProperty("queryString")&&(e.queryString=n.replace(e.queryString,r,!0)),e.region=n.replace(e.region,r,!0,"region"),e.region=n.getActualRegion(e.region),e.logGroupNames&&(e.logGroupNames=e.logGroupNames.map((function(e){return n.replace(e,r,!0,"log groups")})))}));var s=function(e){return Object(F.toDataQueryResponse)(e).data||[]};return this.awsRequest("/api/tsdb/query",o).pipe(Object(A.a)((function(e){return s({data:e})})),Object(E.a)((function(e){var t;if(null===(t=e.data)||void 0===t?void 0:t.error)throw e.data.error;throw e})))}},{key:"getRegions",value:function(){return this.doMetricQueryRequest("regions",null).then((function(e){return[{label:"default",value:"default",text:"default"}].concat(de(e))}))}},{key:"getNamespaces",value:function(){return this.doMetricQueryRequest("namespaces",null)}},{key:"getMetrics",value:(p=ye(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:return e.abrupt("return",this.doMetricQueryRequest("metrics",{region:this.templateSrv.replace(this.getActualRegion(r)),namespace:this.templateSrv.replace(t)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"getDimensionKeys",value:(l=ye(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:return e.abrupt("return",this.doMetricQueryRequest("dimension_keys",{region:this.templateSrv.replace(this.getActualRegion(r)),namespace:this.templateSrv.replace(t)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"getDimensionValues",value:(u=ye(regeneratorRuntime.mark((function e(t,r,n,a,i){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&n){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.doMetricQueryRequest("dimension_values",{region:this.templateSrv.replace(this.getActualRegion(t)),namespace:this.templateSrv.replace(r),metricName:this.templateSrv.replace(n.trim()),dimensionKey:this.templateSrv.replace(a),dimensions:this.convertDimensionFormat(i,{})});case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,a){return u.apply(this,arguments)})},{key:"getEbsVolumeIds",value:function(e,t){return this.doMetricQueryRequest("ebs_volume_ids",{region:this.templateSrv.replace(this.getActualRegion(e)),instanceId:this.templateSrv.replace(t)})}},{key:"getEc2InstanceAttribute",value:function(e,t,r){return this.doMetricQueryRequest("ec2_instance_attribute",{region:this.templateSrv.replace(this.getActualRegion(e)),attributeName:this.templateSrv.replace(t),filters:r})}},{key:"getResourceARNs",value:function(e,t,r){return this.doMetricQueryRequest("resource_arns",{region:this.templateSrv.replace(this.getActualRegion(e)),resourceType:this.templateSrv.replace(t),tags:r})}},{key:"metricFindQuery",value:(o=ye(regeneratorRuntime.mark((function e(t){var r,n,a,i,o,s,u,c,l,p,f,m,d,g,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.match(/^regions\(\)/)){e.next=3;break}return e.abrupt("return",this.getRegions());case 3:if(!t.match(/^namespaces\(\)/)){e.next=6;break}return e.abrupt("return",this.getNamespaces());case 6:if(!(o=t.match(/^metrics\(([^\)]+?)(,\s?([^,]+?))?\)/))){e.next=11;break}return n=o[1],r=o[3],e.abrupt("return",this.getMetrics(n,r));case 11:if(!(s=t.match(/^dimension_keys\(([^\)]+?)(,\s?([^,]+?))?\)/))){e.next=16;break}return n=s[1],r=s[3],e.abrupt("return",this.getDimensionKeys(n,r));case 16:if(!(u=t.match(/^dimension_values\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)(,\s?(.+))?\)/))){e.next=25;break}return r=u[1],n=u[2],a=u[3],c=u[4],i={},u[6]&&(i=JSON.parse(this.templateSrv.replace(u[6]))),e.abrupt("return",this.getDimensionValues(r,n,a,c,i));case 25:if(!(l=t.match(/^ebs_volume_ids\(([^,]+?),\s?([^,]+?)\)/))){e.next=30;break}return r=l[1],p=l[2],e.abrupt("return",this.getEbsVolumeIds(r,p));case 30:if(!(f=t.match(/^ec2_instance_attribute\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/))){e.next=36;break}return r=f[1],m=f[2],i=JSON.parse(this.templateSrv.replace(f[3])),e.abrupt("return",this.getEc2InstanceAttribute(r,m,i));case 36:if(!(d=t.match(/^resource_arns\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/))){e.next=42;break}return r=d[1],g=d[2],v=JSON.parse(this.templateSrv.replace(d[3])),e.abrupt("return",this.getResourceARNs(r,g,v));case 42:if(!t.match(/^statistics\(\)/)){e.next=45;break}return e.abrupt("return",this.standardStatistics.map((function(e){return{value:e,label:e,text:e}})));case 45:return e.abrupt("return",Promise.resolve([]));case 46:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"annotationQuery",value:function(e){var t=this,r=e.annotation,n=r.statistics.map((function(e){return t.templateSrv.replace(e)})),a=r.prefixMatching?"":"300",i=r.period||a;i=parseInt(i,10);var o={prefixMatching:r.prefixMatching,region:this.templateSrv.replace(this.getActualRegion(r.region)),namespace:this.templateSrv.replace(r.namespace),metricName:this.templateSrv.replace(r.metricName),dimensions:this.convertDimensionFormat(r.dimensions,{}),statistics:n,period:i,actionPrefix:r.actionPrefix||"",alarmNamePrefix:r.alarmNamePrefix||""};return this.awsRequest("/api/tsdb/query",{from:e.range.from.valueOf().toString(),to:e.range.to.valueOf().toString(),queries:[be({refId:"annotationQuery",datasourceId:this.id,type:"annotationQuery"},o)]}).pipe(Object(A.a)((function(e){return e.results.annotationQuery.tables[0].rows.map((function(e){return{annotation:r,time:Date.parse(e[0]),title:e[1],tags:[e[2]],text:e[3]}}))}))).toPromise()}},{key:"targetContainsTemplate",value:function(e){var t,r=this;return this.templateSrv.variableExists(e.region)||this.templateSrv.variableExists(e.namespace)||this.templateSrv.variableExists(e.metricName)||this.templateSrv.variableExists(e.expression)||(null===(t=e.logGroupNames)||void 0===t?void 0:t.some((function(e){return r.templateSrv.variableExists(e)})))||s.a.find(e.dimensions,(function(e,t){return r.templateSrv.variableExists(t)||r.templateSrv.variableExists(e)}))}},{key:"testDatasource",value:function(){var e=this.defaultRegion;return this.getDimensionValues(e,"AWS/Billing","EstimatedCharges","ServiceName",{}).then((function(){return{status:"success",message:"Data source is working"}}))}},{key:"awsRequest",value:function(e,t){var r={method:"POST",url:e,data:t};return Object(F.getBackendSrv)().fetch(r).pipe(Object(A.a)((function(e){return e.data})))}},{key:"getDefaultRegion",value:function(){return this.defaultRegion}},{key:"getActualRegion",value:function(e){return"default"===e||void 0===e||""===e?this.getDefaultRegion():e}},{key:"showContextToggle",value:function(){return!0}},{key:"convertToCloudWatchTime",value:function(e,t){return s.a.isString(e)&&(e=c.dateMath.parse(e,t)),Math.round(e.valueOf()/1e3)}},{key:"convertDimensionFormat",value:function(e,t){var r=this;return Object.entries(e).reduce((function(e,n){var a=ge(n,2),i=a[0],o=a[1];if(i=r.replace(i,t,!0,"dimension keys"),Array.isArray(o))return be({},e,Se({},i,o));var s=r.templateSrv.getVariables().find((function(e){return e.name===r.templateSrv.getVariableName(o)}));return s?s.multi?be({},e,Se({},i,r.templateSrv.replace(o,t,"pipe").split("|"))):be({},e,Se({},i,[r.templateSrv.replace(o,t)])):be({},e,Se({},i,[o]))}),{})}},{key:"replace",value:function(e,t,r,n){var a=this;if(r&&e){var i=this.templateSrv.getVariables().find((function(t){return t.name===a.templateSrv.getVariableName(e)}));i&&i.multi&&this.debouncedCustomAlert("CloudWatch templating error","Multi template variables are not supported for ".concat(n||e))}return this.templateSrv.replace(e,t)}},{key:"getQueryDisplayText",value:function(e){var t;return"Logs"===e.queryMode?null!==(t=e.expression)&&void 0!==t?t:"":JSON.stringify(e)}},{key:"interpolateVariablesInQueries",value:function(e,t){var r=this;return e.length?e.map((function(e){return be({},e,{region:r.getActualRegion(r.replace(e.region,t)),expression:r.replace(e.expression,t)},!("Logs"===e.queryMode)&&r.interpolateMetricsQueryVariables(e,t))})):e}},{key:"interpolateMetricsQueryVariables",value:function(e,t){var r=this;return{alias:this.replace(e.alias,t),metricName:this.replace(e.metricName,t),namespace:this.replace(e.namespace,t),period:this.replace(e.period,t),dimensions:Object.entries(e.dimensions).reduce((function(e,n){var a=ge(n,2),i=a[0],o=a[1];return Array.isArray(o)?be({},e,Se({},i,o)):be({},e,Se({},r.replace(i,t),r.replace(o,t)))}),{})}}}])&&we(r.prototype,n),i&&we(r,i),t}(c.DataSourceApi);function Pe(e){var t=e.lastIndexOf(":");return e.substr(t+1)}function Ie(e){return[S.Complete,S.Cancelled,S.Failed,S.Timeout].includes(e)}function Ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var qe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s.a.defaultsDeep(this.annotation,{namespace:"",metricName:"",expression:"",dimensions:{},region:"default",id:"",alias:"",statistics:["Average"],matchExact:!0,prefixMatching:!1,actionPrefix:"",alarmNamePrefix:""}),this.onChange=this.onChange.bind(this)}var t,r,n;return t=e,(r=[{key:"onChange",value:function(e){Object.assign(this.annotation,e)}}])&&Ne(t.prototype,r),n&&Ne(t,n),e}();qe.templateUrl="partials/annotations.editor.html";var Te,Me,De=r("ftg2"),Fe=r("NIg9"),Le=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Qe=(Te=["",""],Me=["",""],Object.freeze(Object.defineProperties(Te,{raw:{value:Object.freeze(Me)}})));function _e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Ve=function(){function e(){for(var t=this,r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];return _e(this,e),this.tag=function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return"function"==typeof e?t.interimTag.bind(t,e):"string"==typeof e?t.transformEndResult(e):(e=e.map(t.transformString.bind(t)),t.transformEndResult(e.reduce(t.processSubstitutions.bind(t,n))))},n.length>0&&Array.isArray(n[0])&&(n=n[0]),this.transformers=n.map((function(e){return"function"==typeof e?e():e})),this.tag}return Le(e,[{key:"interimTag",value:function(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];return this.tag(Qe,e.apply(void 0,[t].concat(n)))}},{key:"processSubstitutions",value:function(e,t,r){var n=this.transformSubstitution(e.shift(),t);return"".concat(t,n,r)}},{key:"transformString",value:function(e){return this.transformers.reduce((function(e,t){return t.onString?t.onString(e):e}),e)}},{key:"transformSubstitution",value:function(e,t){return this.transformers.reduce((function(e,r){return r.onSubstitution?r.onSubstitution(e,t):e}),e)}},{key:"transformEndResult",value:function(e){return this.transformers.reduce((function(e,t){return t.onEndResult?t.onEndResult(e):e}),e)}}]),e}(),Ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{onEndResult:function(t){if(""===e)return t.trim();if("start"===(e=e.toLowerCase())||"left"===e)return t.replace(/^\s*/,"");if("end"===e||"right"===e)return t.replace(/\s*$/,"");throw new Error("Side not supported: "+e)}}};function Be(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var We=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"initial";return{onEndResult:function(t){if("initial"===e){var r=t.match(/^[^\S\n]*(?=\S)/gm),n=r&&Math.min.apply(Math,Be(r.map((function(e){return e.length}))));if(n){var a=new RegExp("^.{"+n+"}","gm");return t.replace(a,"")}return t}if("all"===e)return t.replace(/^[^\S\n]+/gm,"");throw new Error("Unknown type: "+e)}}},Ue=function(e,t){return{onEndResult:function(r){if(null==e||null==t)throw new Error("replaceResultTransformer requires at least 2 arguments.");return r.replace(e,t)}}},Ke=function(e,t){return{onSubstitution:function(r,n){if(null==e||null==t)throw new Error("replaceSubstitutionTransformer requires at least 2 arguments.");return null==r?r:r.toString().replace(e,t)}}},ze={separator:"",conjunction:"",serial:!1},Je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ze;return{onSubstitution:function(t,r){if(Array.isArray(t)){var n=t.length,a=e.separator,i=e.conjunction,o=e.serial,s=r.match(/(\n?[^\S\n]+)$/);if(t=s?t.join(a+s[1]):t.join(a+" "),i&&n>1){var u=t.lastIndexOf(a);t=t.slice(0,u)+(o?a:"")+" "+i+t.slice(u+1)}}return t}}},$e=function(e){return{onSubstitution:function(t,r){if(null==e||"string"!=typeof e)throw new Error("You need to specify a string character to split by.");return"string"==typeof t&&t.includes(e)&&(t=t.split(e)),t}}},Ze=function(e){return null!=e&&!Number.isNaN(e)&&"boolean"!=typeof e},He=function(){return{onSubstitution:function(e){return Array.isArray(e)?e.filter(Ze):Ze(e)?e:""}}},Xe=(new Ve(Je({separator:","}),We,Ge),new Ve(Je({separator:",",conjunction:"and"}),We,Ge),new Ve(Je({separator:",",conjunction:"or"}),We,Ge),new Ve($e("\n"),He,Je,We,Ge),new Ve($e("\n"),Je,We,Ge,Ke(/&/g,"&amp;"),Ke(/</g,"&lt;"),Ke(/>/g,"&gt;"),Ke(/"/g,"&quot;"),Ke(/'/g,"&#x27;"),Ke(/`/g,"&#x60;")),new Ve(Ue(/(?:\n(?:\s*))+/g," "),Ge),new Ve(Ue(/(?:\n\s*)/g,""),Ge),new Ve(Je({separator:","}),Ue(/(?:\s+)/g," "),Ge),new Ve(Je({separator:",",conjunction:"or"}),Ue(/(?:\s+)/g," "),Ge),new Ve(Je({separator:",",conjunction:"and"}),Ue(/(?:\s+)/g," "),Ge),new Ve(Je,We,Ge),new Ve(Je,Ue(/(?:\s+)/g," "),Ge),new Ve(We,Ge)),Ye=new Ve(We("all"),Ge),et=r("CIDn"),tt=r("kDDq");function rt(e){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function at(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function it(e,t){return!t||"object"!==rt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ot(e){return(ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function st(e,t){return(st=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ut(){var e=Rt(["\n  margin-top: 5px;\n"]);return ut=function(){return e},e}function ct(){var e=Rt(['fields requestId, latency |\n                           filter logType = "RequestSummary" |\n                           sort latency desc |\n                           limit 10']);return ct=function(){return e},e}function lt(){var e=Rt(['fields ispresent(resolverArn) as isRes |\n                           filter isRes |\n                           filter logType = "Tracing" |\n                           stats min(duration), max(duration), avg(duration) as avgDur by resolverArn |\n                           sort avgDur desc |\n                           limit 10']);return lt=function(){return e},e}function pt(){var e=Rt(['fields requestId, latency |\n                           filter logType = "RequestSummary" |\n                           sort latency desc |\n                           limit 10']);return pt=function(){return e},e}function ft(){var e=Rt(['fields ispresent(resolverArn) as isRes |\n                           stats count() as errorCount by resolverArn, logType |\n                           filter isRes and (logType = "RequestMapping" or logType = "ResponseMapping") and fieldInError |\n                           sort errorCount desc |\n                           limit 10']);return ft=function(){return e},e}function mt(){var e=Rt(['fields ispresent(resolverArn) as isRes |\n                           stats count() as invocationCount by resolverArn |\n                           filter isRes |\n                           filter logType = "Tracing" |\n                           sort invocationCount desc |\n                           limit 10']);return mt=function(){return e},e}function dt(){var e=Rt(['fields resolverArn, duration |\n                           filter logType = "Tracing" |\n                           sort duration desc |\n                           limit 10']);return dt=function(){return e},e}function gt(){var e=Rt(['fields ispresent(graphQLAPIId) as isApi |\n                           filter isApi |\n                           filter logType = "RequestSummary" |\n                           stats count() as statusCount by statusCode |\n                           sort statusCount desc']);return gt=function(){return e},e}function vt(){var e=Rt(["filter @message like /Exception/ |\n                           stats count(*) as exceptionCount by bin(5m) |\n                           sort exceptionCount desc"]);return vt=function(){return e},e}function yt(){var e=Rt(["fields @timestamp, @message |\n                           sort @timestamp desc |\n                           limit 25"]);return yt=function(){return e},e}function ht(){var e=Rt(['filter eventName="CreateUser" |\n                           fields awsRegion, requestParameters.userName, responseElements.user.arn']);return ht=function(){return e},e}function bt(){var e=Rt(['filter eventSource="ec2.amazonaws.com" |\n                           stats count(*) as eventCount by eventName, awsRegion |\n                           sort eventCount desc']);return bt=function(){return e},e}function St(){var e=Rt(['filter action="REJECT" |\n                           stats count(*) as numRejections by srcAddr |\n                           sort numRejections desc |\n                           limit 20']);return St=function(){return e},e}function xt(){var e=Rt(["stats sum(bytes) as bytesTransferred by srcAddr, dstAddr |\n                           sort bytesTransferred desc |\n                           limit 10"]);return xt=function(){return e},e}function wt(){var e=Rt(['filter @type = "REPORT" |\n                           fields @requestId, @billedDuration |\n                           sort by @billedDuration desc']);return wt=function(){return e},e}function kt(){var e=Rt(['\n        filter @type = "REPORT" |\n        stats max(@memorySize / 1024 / 1024) as provisonedMemoryMB,\n              min(@maxMemoryUsed / 1024 / 1024) as smallestMemoryRequestMB,\n              avg(@maxMemoryUsed / 1024 / 1024) as avgMemoryUsedMB,\n              max(@maxMemoryUsed / 1024 / 1024) as maxMemoryUsedMB,\n              provisonedMemoryMB - maxMemoryUsedMB as overProvisionedMB']);return kt=function(){return e},e}function Ot(){var e=Rt(['filter @type = "REPORT" |\n                           stats avg(@duration), max(@duration), min(@duration) by bin(5m)']);return Ot=function(){return e},e}function Rt(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var jt=[{category:"Lambda",examples:[{title:"View latency statistics for 5-minute intervals",expr:Ye(Ot())},{title:"Determine the amount of overprovisioned memory",expr:Xe(kt())},{title:"Find the most expensive requests",expr:Ye(wt())}]},{category:"VPC Flow Logs",examples:[{title:"Average, min, and max byte transfers by source and destination IP addresses",expr:"stats avg(bytes), min(bytes), max(bytes) by srcAddr, dstAddr"},{title:"IP addresses using UDP transfer protocol",expr:"filter protocol=17 | stats count(*) by srcAddr"},{title:"Top 10 byte transfers by source and destination IP addresses",expr:Ye(xt())},{title:"Top 20 source IP addresses with highest number of rejected requests",expr:Ye(St())}]},{category:"CloudTrail",examples:[{title:"Number of log entries by service, event type, and region",expr:"stats count(*) by eventSource, eventName, awsRegion"},{title:"Number of log entries by region and EC2 event type",expr:Ye(bt())},{title:"Regions, usernames, and ARNs of newly created IAM users",expr:Ye(ht())}]},{category:"Common Queries",examples:[{title:"25 most recently added log events",expr:Ye(yt())},{title:"Number of exceptions logged every 5 minutes",expr:Ye(vt())},{title:"List of log events that are not exceptions",expr:"fields @message | filter @message not like /Exception/"}]},{category:"Route 53",examples:[{title:"Number of requests received every 10  minutes by edge location",expr:"stats count(*) by queryType, bin(10m)"},{title:"Number of unsuccessful requests by domain",expr:'filter responseCode="SERVFAIL" | stats count(*) by queryName'},{title:"Number of requests received every 10  minutes by edge location",expr:"stats count(*) as numRequests by resolverIp | sort numRequests desc | limit 10"}]},{category:"AWS AppSync",examples:[{title:"Number of unique HTTP status codes",expr:Ye(gt())},{title:"Top 10 resolvers with maximum latency",expr:Ye(dt())},{title:"Most frequently invoked resolvers",expr:Ye(mt())},{title:"Resolvers with most errors in mapping templates",expr:Ye(ft())},{title:"Field latency statistics",expr:Ye(pt())},{title:"Resolver latency statistics",expr:Ye(lt())},{title:"Top 10 requests with maximum latency",expr:Ye(ct())}]}];var Ct=Object(tt.css)(ut()),At=function(e){function t(){return nt(this,t),it(this,ot(t).apply(this,arguments))}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&st(e,t)}(t,e),r=t,(n=[{key:"onClickExample",value:function(e){this.props.onClickExample(e)}},{key:"renderExpression",value:function(e,t){var r=this;return p.a.createElement("div",{className:"cheat-sheet-item__example",key:e,onClick:function(t){return r.onClickExample({refId:"A",expression:e,queryMode:"Logs",region:"default",id:"A"})}},p.a.createElement("pre",null,function(e,t){var r=B.i,n=Object(et.c)(U.a.tokenize(e,r)).filter((function(e){return"string"!=typeof e})).map((function(e,r){return p.a.createElement("span",{className:"prism-token token ".concat(e.types.join(" ")," ").concat(e.aliases.join(" ")),key:"".concat(t,"-token-").concat(r)},e.content)}));return p.a.createElement("div",{className:"slate-query-field"},n)}(e,t)))}},{key:"renderLogsCheatSheet",value:function(){var e=this;return p.a.createElement("div",null,p.a.createElement("h2",null,"CloudWatch Logs Cheat Sheet"),jt.map((function(t,r){return p.a.createElement("div",{key:"".concat(t.category,"-").concat(r)},p.a.createElement("div",{className:"cheat-sheet-item__title ".concat(Object(tt.cx)(Ct))},t.category),t.examples.map((function(t,r){return p.a.createElement("div",{className:"cheat-sheet-item",key:"item-".concat(r)},p.a.createElement("h4",null,t.title),e.renderExpression(t.expr,"item-".concat(r)))})))})))}},{key:"render",value:function(){var e=this;return p.a.createElement("div",null,p.a.createElement("h2",null,"CloudWatch Logs Cheat Sheet"),jt.map((function(t,r){return p.a.createElement("div",{key:"cat-".concat(r)},p.a.createElement("div",{className:"cheat-sheet-item__title ".concat(Object(tt.cx)(Ct))},t.category),t.examples.map((function(t,r){return p.a.createElement("div",{className:"cheat-sheet-item",key:"item-".concat(r)},p.a.createElement("h4",null,t.title),e.renderExpression(t.expr,"item-".concat(r)))})))})))}}])&&at(r.prototype,n),a&&at(r,a),t}(l.PureComponent);r.d(t,"plugin",(function(){return Et}));var Et=new c.DataSourcePlugin(Ee).setQueryEditorHelp(At).setConfigEditor((function(e){var t=b(Object(l.useState)(),2),r=t[0],n=t[1],a=function(e){g.d.dispatch(Object(v.b)(Object(y.c)("CloudWatch Authentication",e)))};return Object(l.useEffect)((function(){Object(d.a)().loadDatasource(e.options.name).then((function(e){return n(e)})),"arn"===e.options.jsonData.authType?a('Since grafana 7.3 authentication type "arn" is deprecated, falling back to default SDK provider'):"credentials"!==e.options.jsonData.authType||e.options.jsonData.profile||e.options.jsonData.database||a('As of grafana 7.3 authentication type "credentials" should be used only for shared file credentials.              If you don\'t have a credentials file, switch to the default SDK provider for extracting credentials              from environment variables or IAM roles')}),[]),p.a.createElement(p.a.Fragment,null,p.a.createElement(m.ConnectionConfig,h({},e,{loadRegions:r&&function(){return r.getRegions().then((function(e){return e.filter((function(e){return"default"!==e.value})).map((function(e){return e.value}))}))}}),p.a.createElement(f.InlineField,{label:"Namespaces of Custom Metrics",labelWidth:28,tooltip:"Namespaces of Custom Metrics."},p.a.createElement(f.Input,{width:60,placeholder:"Namespace1,Namespace2",value:e.options.jsonData.customMetricsNamespaces||"",onChange:Object(c.onUpdateDatasourceJsonDataOption)(e,"customMetricsNamespaces")}))))})).setQueryEditor(Fe.a).setExploreMetricsQueryField(Fe.a).setExploreLogsQueryField(De.a).setAnnotationQueryCtrl(qe).setChannelSupport({getChannelConfig:function(e){return{path:e}},getSupportedPaths:function(){return[]}})}}]);
//# sourceMappingURL=cloudwatchPlugin.1c3a1c85d09a392be724.js.map