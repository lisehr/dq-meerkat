(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{EaOu:function(e,t,r){"use strict";r.r(t);var n=r("Obii"),a=r("t8hP"),o=r("m257"),i=r("NPB1"),u=r("5kRJ"),l=r("BkRI"),s=r.n(l),c=r("la6v"),p=r.n(c),f=r("HyWp"),m=r.n(f),h=r("K9Ia"),d=r("F/XL"),v=r("y3By"),y=r("p0ib"),g=r("VNr4"),b=r("XlPw"),O=r("xMyE"),j=r("VnD/"),E=r("67Y/"),w=r("9Z1F"),x=r("eqT+"),P=r("48Ei"),S=r("ceQ3"),_=r("LvDl"),T=r.n(_);function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k(e,t,r){var n=[];if(e.trim().match(/^\w+_bucket$/)){n.push({type:"HISTOGRAM_QUANTILE",label:"Time series has buckets, you probably wanted a histogram.",fix:{label:"Fix by adding histogram_quantile().",action:{type:"ADD_HISTOGRAM_QUANTILE",query:e}}})}if(-1===e.indexOf("rate(")&&-1===e.indexOf("increase(")){var a,o,i,u=e.match(/\b(\w+_(total|sum|count))\b/),l=u?u[1]:"",s=null!==(a=null==r||null===(o=r.languageProvider)||void 0===o?void 0:o.metricsMetadata)&&void 0!==a?a:{},c=Object.keys(s),p=!1;if(c.length>0)l=null!==(i=c.find((function(t){if("counter"===s[t][0].type.toLowerCase()){var r=new RegExp("\\b".concat(t,"\\b"));if(e.match(r))return p=!0,!0}return!1})))&&void 0!==i?i:"";if(l){var f,m=e.trim().match(/^\w+$/),h=p?"is":"looks like",d="Metric ".concat(l," ").concat(h," a counter.");m?f={label:"Fix by adding rate().",action:{type:"ADD_RATE",query:e}}:d="".concat(d," Try applying a rate() function."),n.push({type:"APPLY_RATE",label:d,fix:f})}}if(r&&r.ruleMappings){var v=r.ruleMappings,y=Object.keys(v).reduce((function(t,r){return e.search(r)>-1?function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){D(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,D({},r,v[r])):t}),{});if(T.a.size(y)>0){n.push({type:"EXPAND_RULES",label:"Query contains recording rules.",fix:{label:"Expand rules",action:{type:"EXPAND_RULES",query:e,mapping:y}}})}}t&&t.length>=20&&(e.trim().match(/^\w+$/)&&n.push({type:"ADD_SUM",label:"Many time series results returned.",fix:{label:"Consider aggregating with sum().",action:{type:"ADD_SUM",query:e,preventSubmit:!0}}}));return n}var q=r("VphZ");function C(e){return"cancelled"in e}function R(e){return"values"in e}function A(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function F(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){L(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function L(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function M(e,t){var r,o={format:t.target.format,step:t.query.step,legendFormat:t.target.legendFormat,start:t.query.start,end:t.query.end,query:t.query.expr,responseListLength:t.responseListLength,scopedVars:t.scopedVars,refId:t.target.refId,valueWithRefId:t.target.valueWithRefId,meta:{preferredVisualisationType:U(t.query.instant,t.mixedQueries)}},i=e.data.data;if(null!=(r=i)&&Array.isArray(r)&&r.length&&"exemplars"in r[0]){var u,l=[];i.forEach((function(e){var t=e.exemplars.map((function(t){var r;return N((L(r={},n.TIME_SERIES_TIME_FIELD_NAME,1e3*t.timestamp),L(r,n.TIME_SERIES_VALUE_FIELD_NAME,t.value),r),t.labels,{},e.seriesLabels)}));l.push.apply(l,F(t))}));var s=function(e,t){var r=t.step||15,a={},o=[],i=!0,u=!1,l=void 0;try{for(var s,c=e[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var p=s.value,f=String(Math.floor(p[n.TIME_SERIES_TIME_FIELD_NAME]/1e3/r)*r*1e3);a[f]||(a[f]=[]),a[f].push(p),o.push(p[n.TIME_SERIES_VALUE_FIELD_NAME])}}catch(e){u=!0,l=e}finally{try{i||null==c.return||c.return()}finally{if(u)throw l}}var m=Object(q.deviation)(o),h=Object.keys(a).sort(),d=[],v=!0,y=!1,g=void 0;try{for(var b,O=function(){var e=b.value,t=a[e];if(1===t.length)d.push(t[0]);else{var r=t.map((function(e){return e[n.TIME_SERIES_VALUE_FIELD_NAME]})).sort(q.descending).reduce((function(e,t){if(0===e.length)e.push(t);else{var r=e[e.length-1];m&&r-t>=2*m&&e.push(t)}return e}),[]);d.push.apply(d,F(r.map((function(e){return t.find((function(t){return t[n.TIME_SERIES_VALUE_FIELD_NAME]===e}))}))))}},j=h[Symbol.iterator]();!(v=(b=j.next()).done);v=!0)O()}catch(e){y=!0,g=e}finally{try{v||null==j.return||j.return()}finally{if(y)throw g}}return d}(l,o),c=new n.ArrayDataFrame(s);if(c.meta={dataTopic:n.DataTopic.Annotations},null===(u=t.exemplarTraceIdDestinations)||void 0===u?void 0:u.length){var p=!0,f=!1,m=void 0;try{for(var h,d=function(){var e=h.value,t=c.fields.find((function(t){return t.name===e.name}));if(t){var r,n=function(e){var t=[];if(e.datasourceUid){var r,n=Object(a.getDataSourceSrv)().getInstanceSettings(e.datasourceUid);t.push({title:"Query with ".concat(null==n?void 0:n.name),url:"",internal:{query:{query:"${__value.raw}",queryType:"getTrace"},datasourceUid:e.datasourceUid,datasourceName:null!==(r=null==n?void 0:n.name)&&void 0!==r?r:"Data source not found"}})}e.url&&t.push({title:"Go to ".concat(e.url),url:e.url,targetBlank:!0});return t}(e);t.config.links=(null===(r=t.config.links)||void 0===r?void 0:r.length)?[].concat(F(t.config.links),F(n)):n}},v=t.exemplarTraceIdDestinations[Symbol.iterator]();!(p=(h=v.next()).done);p=!0)d()}catch(e){f=!0,m=e}finally{try{p||null==v.return||v.return()}finally{if(f)throw m}}}return[c]}if(!(null==i?void 0:i.result))return[];if("scalar"===i.resultType)return[{meta:o.meta,refId:o.refId,length:1,fields:[B([i.result]),H({data:[i.result]})]}];if("table"===o.format)return[function(e,t){if(!e||0===e.length)return{meta:t.meta,refId:t.refId,length:0,fields:[]};var r=t.responseListLength>1||t.valueWithRefId?"Value #".concat(t.refId):"Value",a=B([]),o=Object.keys(e.reduce((function(e,t){return N({},e,{},t.metric)}),{})).sort().map((function(e){return{name:e,config:{filterable:!0},type:"le"===e?n.FieldType.number:n.FieldType.string,values:new n.ArrayVector}})),i=H({data:[],valueName:r});return e.forEach((function(e){R(e)?e.values.forEach((function(t){a.values.add(1e3*t[0]),o.forEach((function(t){return t.values.add(V(e.metric,t.name))})),i.values.add(z(t[1]))})):(a.values.add(1e3*e.value[0]),o.forEach((function(t){return t.values.add(V(e.metric,t.name))})),i.values.add(z(e.value[1])))})),{meta:t.meta,refId:t.refId,length:a.values.length,fields:[a].concat(F(o),[i])}}(i.result,o)];var y=[];return i.result.forEach((function(e){return y.push(function(e,t){var r=function(e,t){if(null==t?void 0:t.legendFormat){return{name:G(Object(a.getTemplateSrv)().replace(t.legendFormat,null==t?void 0:t.scopedVars),e),labels:e}}var r=e.__name__,o=A(e,["__name__"]),i=Object(n.formatLabels)(o),u="".concat(null!=r?r:"").concat(i);u||(u=t.query);return{name:u,labels:o}}(e.metric,t),o=r.name,i=r.labels,u=[];if(R(e)){var l=t.step?1e3*t.step:NaN,s=1e3*t.start,c=[],p=!0,f=!1,m=void 0;try{for(var h,d=e.values[Symbol.iterator]();!(p=(h=d.next()).done);p=!0){var v=h.value,y=z(v[1]);isNaN(y)&&(y=null);for(var g=1e3*v[0],b=s;b<g;b+=l)c.push([b,null]);s=g+l,c.push([g,y])}}catch(e){f=!0,m=e}finally{try{p||null==d.return||d.return()}finally{if(f)throw m}}for(var O=1e3*t.end,j=s;j<=O;j+=l)c.push([j,null]);u.push(B(c,!0)),u.push(H({data:c,parseValue:!1,labels:i,displayNameFromDS:o}))}else u.push(B([e.value])),u.push(H({data:[e.value],labels:i,displayNameFromDS:o}));return{meta:t.meta,refId:t.refId,length:u[0].values.length,fields:u,name:o}}(e,o))})),"heatmap"===o.format?(y.sort(W),function(e){for(var t=e.length-1;t>0;t--){var r=e[t].fields.find((function(e){return e.name===n.TIME_SERIES_VALUE_FIELD_NAME})),a=e[t-1].fields.find((function(e){return e.name===n.TIME_SERIES_VALUE_FIELD_NAME}));if(!r||!a)throw new Error("Prometheus heatmap transform error: data should be a time series");for(var o=0;o<r.values.length;o++){var i=a.values.get(o)||[0];r.values.toArray()[o]-=i}}return e}(y)):y}function U(e,t){return e?"table":t?"graph":void 0}function V(e,t){return e.hasOwnProperty(t)?"le"===t?z(e[t]):e[t]:""}function B(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{name:n.TIME_SERIES_TIME_FIELD_NAME,type:n.FieldType.time,config:{},values:new n.ArrayVector(e.map((function(e){return t?e[0]:1e3*e[0]})))}}function H(e){var t=e.data,r=e.valueName,a=void 0===r?n.TIME_SERIES_VALUE_FIELD_NAME:r,o=e.parseValue,i=void 0===o||o,u=e.labels,l=e.displayNameFromDS;return{name:a,type:n.FieldType.number,display:Object(n.getDisplayProcessor)(),config:{displayNameFromDS:l},labels:u,values:new n.ArrayVector(t.map((function(e){return i?z(e[1]):e[1]})))}}function G(e,t){return e.replace(/\{\{\s*(.+?)\s*\}\}/g,(function(e,r){return t[r]?t[r]:""}))}function W(e,t){var r,n;try{var a,o;r=z(null!==(a=e.name)&&void 0!==a?a:""),n=z(null!==(o=t.name)&&void 0!==o?o:"")}catch(e){return console.error(e),0}return r>n?1:r<n?-1:0}function z(e){switch(e){case"+Inf":return Number.POSITIVE_INFINITY;case"-Inf":return Number.NEGATIVE_INFINITY;default:return parseFloat(e)}}var $=r("0/uQ");function K(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Y=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.datasource=t,this.query=r,this.datasource=t,this.query=r,this.range=Object(i.a)().timeRange()}var t,r,n;return t=e,(r=[{key:"process",value:function(){if(this.query.match(/^label_names\(\)\s*$/))return this.labelNamesQuery();var e=this.query.match(/^label_values\((?:(.+),\s*)?([a-zA-Z_][a-zA-Z0-9_]*)\)\s*$/);if(e)return e[1]?this.labelValuesQuery(e[2],e[1]):this.labelValuesQuery(e[2]);var t=this.query.match(/^metrics\((.+)\)\s*$/);if(t)return this.metricNameQuery(t[1]);var r=this.query.match(/^query_result\((.+)\)\s*$/);return r?this.queryResultQuery(r[1]).toPromise():this.metricNameAndLabelsQuery(this.query)}},{key:"labelNamesQuery",value:function(){var e=this.datasource.getPrometheusTime(this.range.from,!1),t=this.datasource.getPrometheusTime(this.range.to,!0),r={start:e.toString(),end:t.toString()};return this.datasource.metadataRequest("/api/v1/labels",r).then((function(e){return T.a.map(e.data.data,(function(e){return{text:e}}))}))}},{key:"labelValuesQuery",value:function(e,t){var r,n=this.datasource.getPrometheusTime(this.range.from,!1),a=this.datasource.getPrometheusTime(this.range.to,!0);if(t){var o={"match[]":t,start:n.toString(),end:a.toString()};return r="/api/v1/series",this.datasource.metadataRequest(r,o).then((function(t){var r=T.a.map(t.data.data,(function(t){return t[e]||""})).filter((function(e){return""!==e}));return T.a.uniq(r).map((function(e){return{text:e,expandable:!0}}))}))}var i={start:n.toString(),end:a.toString()};return r="/api/v1/label/".concat(e,"/values"),this.datasource.metadataRequest(r,i).then((function(e){return T.a.map(e.data.data,(function(e){return{text:e}}))}))}},{key:"metricNameQuery",value:function(e){var t=this.datasource.getPrometheusTime(this.range.from,!1),r=this.datasource.getPrometheusTime(this.range.to,!0),n={start:t.toString(),end:r.toString()};return this.datasource.metadataRequest("/api/v1/label/__name__/values",n).then((function(t){return T.a.chain(t.data.data).filter((function(t){return new RegExp(e).test(t)})).map((function(e){return{text:e,expandable:!0}})).value()}))}},{key:"queryResultQuery",value:function(e){var t=this.datasource.getPrometheusTime(this.range.to,!0),r={expr:e};return this.datasource.performInstantQuery(r,t).pipe(Object(E.a)((function(e){return T.a.map(e.data.data.result,(function(e){var t=e.metric.__name__||"";return delete e.metric.__name__,t+="{"+T.a.map(e.metric,(function(e,t){return t+'="'+e+'"'})).join(",")+"}",{text:t+=" "+e.value[1]+" "+1e3*e.value[0],expandable:!0}}))})))}},{key:"metricNameAndLabelsQuery",value:function(e){var t=this.datasource.getPrometheusTime(this.range.from,!1),r=this.datasource.getPrometheusTime(this.range.to,!0),n={"match[]":e,start:t.toString(),end:r.toString()},a=this;return this.datasource.metadataRequest("/api/v1/series",n).then((function(e){return T.a.map(e.data.data,(function(e){return{text:a.datasource.getOriginalMetricName(e),expandable:!0}}))}))}}])&&K(t.prototype,r),n&&K(t,n),e}();function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function re(e,t){return!t||"object"!==X(t)&&"function"!=typeof t?ae(e):t}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ie=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(a.getTemplateSrv)(),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(i.a)();return ee(this,t),(r=re(this,ne(t).call(this))).datasource=e,r.templateSrv=n,r.timeSrv=o,r.query=r.query.bind(ae(r)),r}var r,o,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(t,e),r=t,(o=[{key:"query",value:function(e){var t=e.targets[0].expr;if(!t)return Object(d.a)({data:[]});var r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){Z(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e.scopedVars,{__interval:{text:this.datasource.interval,value:this.datasource.interval},__interval_ms:{text:n.rangeUtil.intervalToMs(this.datasource.interval),value:n.rangeUtil.intervalToMs(this.datasource.interval)}},this.datasource.getRangeScopedVars(this.timeSrv.timeRange())),a=this.templateSrv.replace(t,r,this.datasource.interpolateQueryExpr),o=new Y(this.datasource,a);return Object($.a)(o.process()).pipe(Object(E.a)((function(e){return{data:e}})))}},{key:"toDataQuery",value:function(e){return{refId:"PrometheusDatasource-VariableQuery",expr:e.query}}}])&&te(r.prototype,o),u&&te(r,u),t}(n.StandardVariableSupport);function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function se(e,t,r,n,a,o,i){try{var u=e[o](i),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,a)}function ce(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){se(o,n,a,i,u,"next",e)}function u(e){se(o,n,a,i,u,"throw",e)}i(void 0)}))}}function pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(r),!0).forEach((function(t){he(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function he(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function de(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ye(e,t){return!t||"object"!==ue(t)&&"function"!=typeof t?be(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var je=["api/v1/query","api/v1/query_range","api/v1/series","api/v1/labels"],Ee=function(e){function t(e){var r,a,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(u.a)(),c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(i.a)();return de(this,t),(a=ye(this,ge(t).call(this,e))).templateSrv=l,a.timeSrv=c,a.metricsNameCache=new m.a(10),a.exemplarErrors=new h.b,a.init=function(){a.loadRules()},a.prepareTargets=function(e,t,r){var o=[],i=[],u=!0,l=!1,c=void 0;try{for(var p,f=e.targets[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;if(m.expr&&!m.hide)if(m.requestId=e.panelId+m.refId,e.app===n.CoreApp.Explore&&m.range===m.instant){var h=s()(m);h.format="table",h.instant=!0,h.range=!1,h.valueWithRefId=!0,delete h.maxDataPoints,h.requestId+="_instant";var d=s()(m);if(d.format="time_series",d.instant=!1,h.range=!0,m.exemplar){var v=s()(m);v.instant=!1,v.requestId+="_exemplar",h.exemplar=!1,d.exemplar=!1,o.push(a.createQuery(v,e,t,r)),i.push(v)}i.push(h,d),o.push(a.createQuery(h,e,t,r),a.createQuery(d,e,t,r))}else if(m.instant&&e.app===n.CoreApp.Explore){var y=s()(m);y.format="table",o.push(a.createQuery(y,e,t,r)),i.push(y)}else{if(m.exemplar&&!m.instant){var g=s()(m);g.requestId+="_exemplar",m.exemplar=!1,o.push(a.createQuery(g,e,t,r)),i.push(g),a.exemplarErrors.next()}m.exemplar&&m.instant&&a.exemplarErrors.next("Exemplars are not available for instant queries."),o.push(a.createQuery(m,e,t,r)),i.push(m)}}}catch(e){l=!0,c=e}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}return{queries:o,activeTargets:i}},a.handleErrors=function(e,t){var r={message:e&&e.statusText||"Unknown error during query transaction. Please check JS console logs.",refId:t.refId};return e.data?"string"==typeof e.data?r.message=e.data:e.data.error&&(r.message=Object(o.r)(e.data.error)):e.message?r.message=e.message:"string"==typeof e&&(r.message=e),r.status=e.status,r.statusText=e.statusText,r},a.createAnnotationQueryOptions=function(e){var t=e.annotation;return me({},e,{interval:t&&t.step&&"string"==typeof t.step?t.step:"60s"})},a.type="prometheus",a.editorSrc="app/features/prometheus/partials/query.editor.html",a.url=e.url,a.basicAuth=e.basicAuth,a.withCredentials=e.withCredentials,a.interval=e.jsonData.timeInterval||"15s",a.queryTimeout=e.jsonData.queryTimeout,a.httpMethod=e.jsonData.httpMethod||"GET",a.directUrl=e.jsonData.directUrl,a.exemplarTraceIdDestinations=e.jsonData.exemplarTraceIdDestinations,a.ruleMappings={},a.languageProvider=new P.b(be(a)),a.lookupsDisabled=null!==(r=e.jsonData.disableMetricsLookup)&&void 0!==r&&r,a.customQueryParameters=new URLSearchParams(e.jsonData.customQueryParameters),a.variables=new ie(be(a),a.templateSrv,a.timeSrv),a}var r,l,c,f,_,T,I,D,q;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(t,e),r=t,(l=[{key:"getQueryDisplayText",value:function(e){return e.expr}},{key:"_addTracingHeaders",value:function(e,t){e.headers={},!this.url.match(/^http/)&&(e.headers["X-Dashboard-Id"]=t.dashboardId,e.headers["X-Panel-Id"]=t.panelId)}},{key:"_request",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=p()(r,{url:this.url+e,method:this.httpMethod,headers:{}});return"GET"===n.method?t&&Object.keys(t).length&&(n.url=n.url+(n.url.search(/\?/)>=0?"&":"?")+Object.entries(t).map((function(e){var t=pe(e,2),r=t[0],n=t[1];return"".concat(encodeURIComponent(r),"=").concat(encodeURIComponent(n))})).join("&")):(n.headers["Content-Type"]="application/x-www-form-urlencoded",n.data=t),(this.basicAuth||this.withCredentials)&&(n.withCredentials=!0),this.basicAuth&&(n.headers.Authorization=this.basicAuth),Object(a.getBackendSrv)().fetch(n)}},{key:"metadataRequest",value:(q=ce(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,u,l,s,c,p,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=f.length>1&&void 0!==f[1]?f[1]:{},n=r,a=!0,o=!1,i=void 0,e.prev=5,u=this.customQueryParameters[Symbol.iterator]();!(a=(l=u.next()).done);a=!0)s=pe(l.value,2),c=s[0],p=s[1],null==n[c]&&(n[c]=p);e.next=13;break;case 9:e.prev=9,e.t0=e.catch(5),o=!0,i=e.t0;case 13:e.prev=13,e.prev=14,a||null==u.return||u.return();case 16:if(e.prev=16,!o){e.next=19;break}throw i;case 19:return e.finish(16);case 20:return e.finish(13);case 21:if(!je.some((function(e){return t.includes(e)}))){e.next=35;break}return e.prev=22,e.next=25,this._request(t,n,{method:this.httpMethod,hideFromInspector:!0}).toPromise();case 25:return e.abrupt("return",e.sent);case 28:if(e.prev=28,e.t1=e.catch(22),"POST"!==this.httpMethod||405!==e.t1.status){e.next=34;break}console.warn("Couldn't use configured POST HTTP method for this request. Trying to use GET method instead."),e.next=35;break;case 34:throw e.t1;case 35:return e.next=37,this._request(t,n,{method:"GET",hideFromInspector:!0}).toPromise();case 37:return e.abrupt("return",e.sent);case 38:case"end":return e.stop()}}),e,this,[[5,9,13,21],[14,,16,20],[22,28]])}))),function(e){return q.apply(this,arguments)})},{key:"interpolateQueryExpr",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(!t.multi&&!t.includeAll)return xe(e);if("string"==typeof e)return Pe(e);var r=e.map((function(e){return Pe(e)}));return 1===r.length?r[0]:"("+r.join("|")+")"}},{key:"targetContainsTemplate",value:function(e){return this.templateSrv.variableExists(e.expr)}},{key:"query",value:function(e){var t=this.getPrometheusTime(e.range.from,!1),r=this.getPrometheusTime(e.range.to,!0),a=this.prepareTargets(e,t,r),o=a.queries,i=a.activeTargets;return o&&o.length?e.app===n.CoreApp.Explore?this.exploreQuery(o,i,r):this.panelsQuery(o,i,r,e.requestId,e.scopedVars):Object(d.a)({data:[],state:n.LoadingState.Done})}},{key:"exploreQuery",value:function(e,t,r){var a=this,o=e.length,i=t.some((function(e){return e.range}))&&t.some((function(e){return e.instant})),u=e.map((function(u,l){var s=t[l],c=Object(v.a)(Object(O.a)((function(){return o--})),Object(j.a)((function(e){return!e.cancelled})),Object(E.a)((function(t){return{data:M(t,{query:u,target:s,responseListLength:e.length,mixedQueries:i,exemplarTraceIdDestinations:a.exemplarTraceIdDestinations}),key:u.requestId,state:0===o?n.LoadingState.Done:n.LoadingState.Loading}})));return u.instant?a.performInstantQuery(u,r).pipe(c):u.exemplar?a.getExemplars(u).pipe(Object(w.a)((function(){return a.exemplarErrors.next("Exemplars for this data source are not available."),Object(d.a)({data:[],state:n.LoadingState.Done})})),c):a.performTimeSeriesQuery(u,u.start,u.end).pipe(c)}));return y.a.apply(void 0,le(u))}},{key:"panelsQuery",value:function(e,t,r,a,o){var i=this,u=e.map((function(a,u){var l=t[u],s=Object(v.a)(Object(j.a)((function(e){return!e.cancelled})),Object(E.a)((function(t){return M(t,{query:a,target:l,responseListLength:e.length,scopedVars:o,exemplarTraceIdDestinations:i.exemplarTraceIdDestinations})})));return a.instant?i.performInstantQuery(a,r).pipe(s):a.exemplar?i.getExemplars(a).pipe(Object(w.a)((function(){return i.exemplarErrors.next("Exemplars for this data source are not available."),Object(d.a)({data:[],state:n.LoadingState.Done})})),s):i.performTimeSeriesQuery(a,a.start,a.end).pipe(s)}));return Object(g.a)(u).pipe(Object(E.a)((function(e){return{data:e.reduce((function(e,t){return[].concat(le(e),le(t))}),[]),key:a,state:n.LoadingState.Done}})))}},{key:"createQuery",value:function(e,t,r,a){var o={hinting:e.hinting,instant:e.instant,exemplar:e.exemplar,step:0,expr:"",requestId:e.requestId,refId:e.refId,start:0,end:0},i=Math.ceil(a-r),u=n.rangeUtil.intervalToSeconds(t.interval),l=n.rangeUtil.intervalToSeconds(this.templateSrv.replace(e.interval||t.interval,t.scopedVars)),s=e.interval?n.rangeUtil.intervalToSeconds(this.templateSrv.replace(e.interval,t.scopedVars)):n.rangeUtil.intervalToSeconds(this.interval),c=e.intervalFactor||1,p=this.adjustInterval(u,l,i,c),f=me({},t.scopedVars,{},this.getRangeScopedVars(t.range),{},this.getRateIntervalScopedVariable(p,s));u!==p&&(u=p,f=Object.assign({},t.scopedVars,me({__interval:{text:u+"s",value:u+"s"},__interval_ms:{text:1e3*u,value:1e3*u}},this.getRateIntervalScopedVariable(u,s),{},this.getRangeScopedVars(t.range)))),o.step=u;var m=e.expr;m=this.templateSrv.getAdhocFilters(this.name).reduce((function(e,t){var r=t.key,n=t.operator,a=t.value;return"=~"!==n&&"!~"!==n||(a=xe(a)),Object(x.b)(e,r,a,n)}),m),o.expr=this.templateSrv.replace(m,f,this.interpolateQueryExpr);var h=function(e,t,r,n){var a=Math.floor((t+n)/r)*r-n,o=Math.floor((e+n)/r)*r-n;return{end:a,start:o}}(r,a,o.step,60*this.timeSrv.timeRange().to.utcOffset());return o.start=h.start,o.end=h.end,this._addTracingHeaders(o,t),o}},{key:"getRateIntervalScopedVariable",value:function(e,t){0===t&&(t=15);var r=Math.max(e+t,4*t);return{__rate_interval:{text:r+"s",value:r+"s"}}}},{key:"adjustInterval",value:function(e,t,r,n){var a=r/11e3;return a>1&&(a=Math.ceil(a)),Math.max(e*n,t,a)}},{key:"performTimeSeriesQuery",value:function(e,t,r){var n=this;if(t>r)throw{message:"Invalid time range"};var a={query:e.expr,start:t,end:r,step:e.step};this.queryTimeout&&(a.timeout=this.queryTimeout);var o=!0,i=!1,u=void 0;try{for(var l,s=this.customQueryParameters[Symbol.iterator]();!(o=(l=s.next()).done);o=!0){var c=pe(l.value,2),p=c[0],f=c[1];null==a[p]&&(a[p]=f)}}catch(e){i=!0,u=e}finally{try{o||null==s.return||s.return()}finally{if(i)throw u}}return this._request("/api/v1/query_range",a,{requestId:e.requestId,headers:e.headers}).pipe(Object(w.a)((function(t){return t.cancelled?Object(d.a)(t):Object(b.a)(n.handleErrors(t,e))})))}},{key:"performInstantQuery",value:function(e,t){var r=this,n={query:e.expr,time:t};this.queryTimeout&&(n.timeout=this.queryTimeout);var a=!0,o=!1,i=void 0;try{for(var u,l=this.customQueryParameters[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var s=pe(u.value,2),c=s[0],p=s[1];null==n[c]&&(n[c]=p)}}catch(e){o=!0,i=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw i}}return this._request("/api/v1/query",n,{requestId:e.requestId,headers:e.headers}).pipe(Object(w.a)((function(t){return t.cancelled?Object(d.a)(t):Object(b.a)(r.handleErrors(t,e))})))}},{key:"metricFindQuery",value:function(e){if(!e)return Promise.resolve([]);var t=me({__interval:{text:this.interval,value:this.interval},__interval_ms:{text:n.rangeUtil.intervalToMs(this.interval),value:n.rangeUtil.intervalToMs(this.interval)}},this.getRangeScopedVars(this.timeSrv.timeRange())),r=this.templateSrv.replace(e,t,this.interpolateQueryExpr),a=new Y(this,r);return a.process()}},{key:"getRangeScopedVars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeSrv.timeRange(),t=e.to.diff(e.from),r=Math.round(t/1e3);return{__range_ms:{text:t,value:t},__range_s:{text:r,value:r},__range:{text:r+"s",value:r+"s"}}}},{key:"annotationQuery",value:(D=ce(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,u,l,s,c,p,f,m,h,d,v,y,g,b,O,j,E,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.annotation,u=i.expr,l=void 0===u?"":u,s=i.tagKeys,c=void 0===s?"":s,p=i.titleFormat,f=void 0===p?"":p,m=i.textFormat,h=void 0===m?"":m,l){e.next=4;break}return e.abrupt("return",Promise.resolve([]));case 4:return d=this.getPrometheusTime(t.range.from,!1),v=this.getPrometheusTime(t.range.to,!0),y=this.createAnnotationQueryOptions(t),g={expr:l,interval:"1s",refId:"X",requestId:"prom-query-".concat(i.name)},b=this.createQuery(g,y,d,v),e.next=12,this.performTimeSeriesQuery(b,b.start,b.end).toPromise();case 12:if(O=e.sent,j=[],E=c.split(","),!C(O)||!O.cancelled){e.next=17;break}return e.abrupt("return",[]);case 17:return w=1e3*Math.floor(null!==(r=b.step)&&void 0!==r?r:15),null==O||null===(n=O.data)||void 0===n||null===(a=n.data)||void 0===a||null===(o=a.result)||void 0===o||o.forEach((function(e){var t=Object.entries(e.metric).filter((function(e){var t=pe(e,1)[0];return E.includes(t)})).map((function(e){var t=pe(e,2);return t[0],t[1]}));e.values.forEach((function(e){var t;i.useValueForTime?(t=Math.floor(parseFloat(e[1])),e[1]=1):t=1e3*Math.floor(parseFloat(e[0])),e[0]=t}));var r=e.values.filter((function(e){return parseFloat(e[1])>=1})).map((function(e){return e[0]})),n=null,a=!0,o=!1,u=void 0;try{for(var l,s=r[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var c,p=l.value;n&&(null!==(c=n.timeEnd)&&void 0!==c?c:0)+w>=p?n.timeEnd=p:(n&&j.push(n),n={time:p,timeEnd:p,annotation:i,title:G(f,e.metric),tags:t,text:G(h,e.metric)})}}catch(e){o=!0,u=e}finally{try{a||null==s.return||s.return()}finally{if(o)throw u}}n&&(n.timeEnd=r[r.length-1],j.push(n))})),e.abrupt("return",j);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"getExemplars",value:function(e){return this._request("/api/v1/query_exemplars",{query:e.expr,start:e.start.toString(),end:e.end.toString()},{requestId:e.requestId,headers:e.headers})}},{key:"getTagKeys",value:(I=ce(regeneratorRuntime.mark((function e(){var t,r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.metadataRequest("/api/v1/labels");case 2:return a=e.sent,e.abrupt("return",null!==(t=null==a||null===(r=a.data)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.map((function(e){return{text:e}})))&&void 0!==t?t:[]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"getTagValues",value:(T=ce(regeneratorRuntime.mark((function e(){var t,r,n,a,o,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>0&&void 0!==i[0]?i[0]:{},e.next=3,this.metadataRequest("/api/v1/label/".concat(a.key,"/values"));case 3:return o=e.sent,e.abrupt("return",null!==(t=null==o||null===(r=o.data)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.map((function(e){return{text:e}})))&&void 0!==t?t:[]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"testDatasource",value:(_=ce(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(new Date).getTime(),r={expr:"1+1"},e.next=4,this.performInstantQuery(r,t/1e3).toPromise();case 4:return n=e.sent,e.abrupt("return","success"===n.data.status?{status:"success",message:"Data source is working"}:{status:"error",message:n.data.error});case 6:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"interpolateVariablesInQueries",value:function(e,t){var r=this,n=e;return e&&e.length&&(n=e.map((function(e){return me({},e,{datasource:r.name,expr:r.templateSrv.replace(e.expr,t,r.interpolateQueryExpr)})}))),n}},{key:"getQueryHints",value:function(e,t){var r;return k(null!==(r=e.expr)&&void 0!==r?r:"",t,this)}},{key:"loadRules",value:(f=ce(regeneratorRuntime.mark((function e(){var t,r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.metadataRequest("/api/v1/rules");case 3:n=e.sent,(a=null===(t=n.data)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.groups)&&(this.ruleMappings=we(a)),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("Rules API is experimental. Ignore next error."),console.error(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return f.apply(this,arguments)})},{key:"modifyQuery",value:function(e,t){var r,n=null!==(r=e.expr)&&void 0!==r?r:"";switch(t.type){case"ADD_FILTER":n=Object(x.b)(n,t.key,t.value);break;case"ADD_FILTER_OUT":n=Object(x.b)(n,t.key,t.value,"!=");break;case"ADD_HISTOGRAM_QUANTILE":n="histogram_quantile(0.95, sum(rate(".concat(n,"[5m])) by (le))");break;case"ADD_RATE":n="rate(".concat(n,"[5m])");break;case"ADD_SUM":n="sum(".concat(n.trim(),") by ($1)");break;case"EXPAND_RULES":t.mapping&&(n=Object(S.b)(n,t.mapping))}return me({},e,{expr:n})}},{key:"getPrometheusTime",value:function(e,t){return"string"==typeof e&&(e=n.dateMath.parse(e,t)),Math.ceil(e.valueOf()/1e3)}},{key:"getTimeRange",value:function(){var e=this.timeSrv.timeRange();return{start:this.getPrometheusTime(e.from,!1),end:this.getPrometheusTime(e.to,!0)}}},{key:"getOriginalMetricName",value:function(e){return function(e){var t=e.__name__||"";delete e.__name__;var r=Object.entries(e).map((function(e){return"".concat(e[0],'="').concat(e[1],'"')})).join(",");return"".concat(t,"{").concat(r,"}")}(e)}}])&&ve(r.prototype,l),c&&ve(r,c),t}(n.DataSourceApi);function we(e){return e.reduce((function(e,t){return t.rules.filter((function(e){return"recording"===e.type})).reduce((function(e,t){return me({},e,he({},t.name,t.query))}),e)}),{})}function xe(e){return"string"==typeof e?e.replace(/\\/g,"\\\\").replace(/'/g,"\\\\'"):e}function Pe(e){return"string"==typeof e?e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]\'+?.()|]/g,"\\\\$&"):e}var Se=r("q1tI"),_e=r.n(Se),Te=r("kDLi"),Ie=r("wZee"),De=r("sGFA");function ke(e){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ce(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(r),!0).forEach((function(t){Re(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Re(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ae(e,t,r,n,a,o,i){try{var u=e[o](i),l=u.value}catch(e){return void r(e)}u.done?t(l):Promise.resolve(l).then(n,a)}function Fe(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Ae(o,n,a,i,u,"next",e)}function u(e){Ae(o,n,a,i,u,"throw",e)}i(void 0)}))}}function Qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ne(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Le(e){return(Le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ue(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Ve="__histograms__";function Be(e,t){var r=t.typeaheadContext,n=t.typeaheadText;switch(r){case"context-labels":var a=Te.DOMUtil.getNextCharacter();a&&"}"!==a&&","!==a||(e+="=");break;case"context-label-values":n.match(/^(!?=~?"|")/)||(e='"'.concat(e)),'"'!==Te.DOMUtil.getNextCharacter()&&(e="".concat(e,'"'))}return e}var He=function(e){function t(e,r){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=Ne(this,Le(t).call(this,e,r))).refreshHint=function(){var e=a.props,t=e.datasource,r=e.query,o=e.data;if(o&&0!==o.series.length){var i=Object(n.isDataFrame)(o.series[0])?o.series.map(n.toLegacyResponseData):o.series,u=t.getQueryHints(r,i),l=u.length>0?u[0]:null;!l&&t.lookupsDisabled&&(l={label:"Labels and metrics lookup was disabled in data source settings.",type:"INFO"}),a.setState({hint:l})}else a.setState({hint:null})},a.refreshMetrics=Fe(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.datasource.languageProvider,a.languageProviderInitializationPromise=Object(De.a)(t.start()),e.prev=2,e.next=5,a.languageProviderInitializationPromise.promise;case 5:return r=e.sent,e.next=8,Promise.all(r);case 8:a.onUpdateLanguage(),e.next=15;break;case 11:if(e.prev=11,e.t0=e.catch(2),e.t0.isCanceled){e.next=15;break}throw e.t0;case 15:case"end":return e.stop()}}),e,null,[[2,11]])}))),a.onChangeMetrics=function(e,t){var r;if(1===t.length){var n=t[0];if(n.children&&0!==n.children.length)return;r=n.value}else{var o=t[0].value,i=t[1].value;r=o===Ve?"histogram_quantile(0.95, sum(rate(".concat(i,"[5m])) by (le))"):i}a.onChangeQuery(r,!0)},a.onChangeQuery=function(e,t){var r=a.props,n=r.query,o=r.onChange,i=r.onRunQuery;o&&(o(Ce({},n,{expr:e})),t&&i&&i())},a.onClickHintFix=function(){var e=a.props,t=e.datasource,r=e.query,n=e.onChange,o=e.onRunQuery,i=a.state.hint;n(t.modifyQuery(r,i.fix.action)),o()},a.onUpdateLanguage=function(){var e=a.props.datasource.languageProvider,t=e.histogramMetrics,r=e.metrics,n=e.metricsMetadata;if(r){var o=function(e,t){var r=/:\w+:/,n=e.filter((function(e){return r.test(e)})),a={label:"Recording rules",value:"__recording_rules__",children:n.slice().sort().map((function(e){return{label:e,value:e}}))},o=n.length>0?[a]:[],i=T.a.chain(e).filter((function(e){return!r.test(e)})).groupBy((function(e){return e.split("_")[0]})).map((function(e,r){return{children:1===e.length&&e[0]===r?[]:e.sort().map((function(e){return function(e,t){var r={label:e,value:e};if(t&&t[e]){var n=t[e][0],a=n.type,o=void 0===a?"":a,i=n.help;r.title=[e,o.toUpperCase(),i].join("\n")}return r}(e,t)})),label:r,value:r}})).sortBy("label").value();return[].concat(o,Ue(i))}(r,n),i=t.map((function(e){return{label:e,value:e}})),u=t.length>0?[{label:"Histograms",value:Ve,children:i,isLeaf:!1}].concat(Ue(o)):o;a.setState({metricsOptions:u,syntaxLoaded:!0})}},a.onTypeahead=function(){var e=Fe(regeneratorRuntime.mark((function e(t){var r,n,o,i,u,l,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.props.datasource.languageProvider){e.next=3;break}return e.abrupt("return",{suggestions:[]});case 3:return n=a.props.history,o=t.prefix,i=t.text,u=t.value,l=t.wrapperClasses,s=t.labelKey,e.next=7,r.provideCompletionItems({text:i,value:u,prefix:o,wrapperClasses:l,labelKey:s},{history:n});case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.plugins=[Object(Te.BracesPlugin)(),Object(Te.SlatePrism)({onlyIn:function(e){return"code_block"===e.type},getSyntax:function(e){return"promql"}},Ce({},Ie.languages,{promql:a.props.datasource.languageProvider.syntax}))],a.state={metricsOptions:[],syntaxLoaded:!1,hint:null},a}var r,a,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(t,e),r=t,(a=[{key:"componentDidMount",value:function(){this.props.datasource.languageProvider&&this.refreshMetrics(),this.refreshHint()}},{key:"componentWillUnmount",value:function(){this.languageProviderInitializationPromise&&this.languageProviderInitializationPromise.cancel()}},{key:"componentDidUpdate",value:function(e){var t=this.props,r=t.data,n=t.datasource.languageProvider,a=t.range;n!==e.datasource.languageProvider&&this.setState({metricsOptions:[],syntaxLoaded:!1});var o=this.rangeChangedToRefresh(a,e.range);(n!==e.datasource.languageProvider||o)&&this.refreshMetrics(),r&&e.data&&e.data.series!==r.series&&this.refreshHint()}},{key:"rangeChangedToRefresh",value:function(e,t){if(e&&t){var r=Object(S.i)(e.from.valueOf())===Object(S.i)(t.from.valueOf()),n=Object(S.i)(e.to.valueOf())===Object(S.i)(t.to.valueOf());return!(r&&n)}return!1}},{key:"render",value:function(){var e,t,r,n=this.props,a=n.datasource,o=n.datasource.languageProvider,i=n.query,u=n.ExtraFieldElement,l=this.state,s=l.metricsOptions,c=l.syntaxLoaded,p=l.hint,f=o?o.cleanText:void 0,m=(e=a.lookupsDisabled,t=c,r=s,e?"(Disabled)":t?r&&0===r.length?"(No metrics found)":"Metrics":"Loading metrics..."),h=!(c&&s&&s.length>0);return _e.a.createElement(_e.a.Fragment,null,_e.a.createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1"},_e.a.createElement("div",{className:"gf-form flex-shrink-0 min-width-5"},_e.a.createElement(Te.ButtonCascader,{options:s,disabled:h,onChange:this.onChangeMetrics},m)),_e.a.createElement("div",{className:"gf-form gf-form--grow flex-shrink-1 min-width-15"},_e.a.createElement(Te.QueryField,{additionalPlugins:this.plugins,cleanText:f,query:i.expr,onTypeahead:this.onTypeahead,onWillApplySuggestion:Be,onBlur:this.props.onBlur,onChange:this.onChangeQuery,onRunQuery:this.props.onRunQuery,placeholder:"Enter a PromQL query (run with Shift+Enter)",portalOrigin:"prometheus",syntaxLoaded:c}))),u,p?_e.a.createElement("div",{className:"query-row-break"},_e.a.createElement("div",{className:"prom-query-field-info text-warning"},p.label," ",p.fix?_e.a.createElement("a",{className:"text-link muted",onClick:this.onClickHintFix},p.fix.label):null)):null)}}])&&Qe(r.prototype,a),o&&Qe(r,o),t}(_e.a.PureComponent);function Ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var We=Object(Se.memo)((function(e){var t=e.panelData,r=e.query,n=e.datasource,a=Ge(Object(Se.useState)(""),2),o=a[0],i=a[1];return Object(Se.useEffect)((function(){if(t){i(function(){if(!t.request)return"";var e=t.request,a=e.range,o=e.interval,i=n.getPrometheusTime(a.from,!1),u=n.getPrometheusTime(a.to,!0),l=Math.ceil(u-i),s=a.to.utc().format("YYYY-MM-DD HH:mm"),c={interval:o},p=n.createQuery(r,c,i,u),f={"g0.expr":p.expr,"g0.range_input":l+"s","g0.end_input":s,"g0.step_input":p.step,"g0.tab":0},m=T.a.map(f,(function(e,t){return t+"="+encodeURIComponent(e)})).join("&");return"".concat(n.directUrl,"/graph?").concat(m)}())}}),[t]),_e.a.createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer"},"Prometheus")})),ze=r("kDDq");function $e(){var e=Xe(["\n      display: flex;\n      align-items: center;\n    "]);return $e=function(){return e},e}function Ke(){var e=Xe(["\n      color: ",";\n    "]);return Ke=function(){return e},e}function Ye(){var e=Xe(["\n      margin-left: ",";\n    "]);return Ye=function(){return e},e}function Xe(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function Je(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ze(e){var t=e.datasource,r=e.onChange,n=e.isEnabled,a=Je(Object(Se.useState)(),2),o=a[0],i=a[1],u=Object(Te.useStyles)(et);Object(Se.useEffect)((function(){var e=t.exemplarErrors.subscribe((function(e){i(e)}));return function(){e.unsubscribe()}}),[t]);var l,s,c,p=Object(ze.cx)((l={},s=u.activeIcon,c=n,s in l?Object.defineProperty(l,s,{value:c,enumerable:!0,configurable:!0,writable:!0}):l[s]=c,l),u.eyeIcon);return _e.a.createElement(Te.InlineLabel,{width:"auto"},_e.a.createElement(Te.Tooltip,{content:null!=o?o:""},_e.a.createElement("div",{className:u.iconWrapper},"Exemplars",_e.a.createElement(Te.IconButton,{name:"eye",tooltip:n?"Disable query with exemplars":"Enable query with exemplars",disabled:!!o,className:p,onClick:function(){r(!n)}}))))}function et(e){return{eyeIcon:Object(ze.css)(Ye(),e.spacing.md),activeIcon:Object(ze.css)(Ke(),e.palette.blue95),iconWrapper:Object(ze.css)($e())}}function tt(e){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function nt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function at(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ot(e){return(ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function it(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e,t){return(ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var lt=Te.LegacyForms.Switch,st=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"},{label:"Heatmap",value:"heatmap"}],ct=T.a.map([1,2,3,4,5,10],(function(e){return{value:e,label:"1/"+e}})),pt=function(e){function t(e){var r,n,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,a=ot(t).call(this,e),(r=!a||"object"!==tt(a)&&"function"!=typeof a?it(n):a).onFieldChange=function(e,t){r.query.expr=e.expr},r.onFormatChange=function(e){r.query.format=e.value,r.setState({formatOption:e},r.onRunQuery)},r.onInstantChange=function(e){var t=e.target.checked;r.query.instant=t,r.setState({instant:t},r.onRunQuery)},r.onIntervalChange=function(e){var t=e.currentTarget.value;r.query.interval=t,r.setState({interval:t})},r.onIntervalFactorChange=function(e){r.query.intervalFactor=e.value,r.setState({intervalFactorOption:e},r.onRunQuery)},r.onLegendChange=function(e){var t=e.currentTarget.value;r.query.legendFormat=t,r.setState({legendFormat:t})},r.onExemplarChange=function(e){r.query.exemplar=e,r.setState({exemplar:e},r.onRunQuery)},r.onRunQuery=function(){var e=it(r).query,t=r.props.query.hide;r.props.onChange(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(r),!0).forEach((function(t){nt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e,{hide:t})),r.props.onRunQuery()};var o=Object.assign({},{expr:"",legendFormat:"",interval:"",exemplar:!0},e.query);return r.query=o,r.state={interval:o.interval,legendFormat:o.legendFormat,formatOption:st.find((function(e){return e.value===o.format}))||st[0],intervalFactorOption:ct.find((function(e){return e.value===o.intervalFactor}))||ct[0],instant:Boolean(o.instant),exemplar:Boolean(o.exemplar)},r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ut(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.datasource,r=e.query,n=e.range,a=e.data,o=this.state,i=o.formatOption,u=o.instant,l=o.interval,s=o.intervalFactorOption,c=o.legendFormat,p=o.exemplar;return _e.a.createElement("div",null,_e.a.createElement(He,{datasource:t,query:r,range:n,onRunQuery:this.onRunQuery,onChange:this.onFieldChange,history:[],data:a}),_e.a.createElement("div",{className:"gf-form-inline"},_e.a.createElement("div",{className:"gf-form"},_e.a.createElement(Te.InlineFormLabel,{width:7,tooltip:"Controls the name of the time series, using name or pattern. For example {{hostname}} will be replaced with label value for the label hostname."},"Legend"),_e.a.createElement("input",{type:"text",className:"gf-form-input",placeholder:"legend format",value:c,onChange:this.onLegendChange,onBlur:this.onRunQuery})),_e.a.createElement("div",{className:"gf-form"},_e.a.createElement(Te.InlineFormLabel,{width:7,tooltip:_e.a.createElement(_e.a.Fragment,null,"An additional lower limit for the step parameter of the Prometheus query and for the"," ",_e.a.createElement("code",null,"$__interval")," and ",_e.a.createElement("code",null,"$__rate_interval"),' variables. The limit is absolute and not modified by the "Resolution" setting.')},"Min step"),_e.a.createElement("input",{type:"text",className:"gf-form-input width-8",placeholder:l,onChange:this.onIntervalChange,onBlur:this.onRunQuery,value:l})),_e.a.createElement("div",{className:"gf-form"},_e.a.createElement("div",{className:"gf-form-label"},"Resolution"),_e.a.createElement(Te.Select,{isSearchable:!1,options:ct,onChange:this.onIntervalFactorChange,value:s})),_e.a.createElement("div",{className:"gf-form"},_e.a.createElement("div",{className:"gf-form-label width-7"},"Format"),_e.a.createElement(Te.Select,{width:16,isSearchable:!1,options:st,onChange:this.onFormatChange,value:i}),_e.a.createElement(lt,{label:"Instant",checked:u,onChange:this.onInstantChange}),_e.a.createElement(Te.InlineFormLabel,{width:10,tooltip:"Link to Graph in Prometheus"},_e.a.createElement(We,{datasource:t,query:this.query,panelData:a}))),_e.a.createElement(Ze,{isEnabled:p,onChange:this.onExemplarChange,datasource:t})))}}])&&at(r.prototype,n),a&&at(r,a),t}(Se.PureComponent),ft=[{title:"Request Rate",expression:"rate(http_request_total[5m])",label:"Given an HTTP request counter, this query calculates the per-second average request rate over the last 5 minutes."},{title:"95th Percentile of Request Latencies",expression:"histogram_quantile(0.95, sum(rate(prometheus_http_request_duration_seconds_bucket[5m])) by (le))",label:"Calculates the 95th percentile of HTTP request rate over 5 minute windows."},{title:"Alerts Firing",expression:'sort_desc(sum(sum_over_time(ALERTS{alertstate="firing"}[24h])) by (alertname))',label:"Sums up the alerts that have been firing over the last 24 hours."},{title:"Step",label:"Defines the graph resolution using a duration format (15s, 1m, 3h, ...). Small steps create high-resolution graphs but can be slow over larger time ranges. Using a longer step lowers the resolution and smooths the graph by producing fewer datapoints. If no step is given the resolution is calculated automatically."}],mt=function(e){return _e.a.createElement("div",null,_e.a.createElement("h2",null,"PromQL Cheat Sheet"),ft.map((function(t,r){return _e.a.createElement("div",{className:"cheat-sheet-item",key:r},_e.a.createElement("div",{className:"cheat-sheet-item__title"},t.title),t.expression?_e.a.createElement("div",{className:"cheat-sheet-item__example",onClick:function(r){return e.onClickExample({refId:"A",expr:t.expression})}},_e.a.createElement("code",null,t.expression)):null,_e.a.createElement("div",{className:"cheat-sheet-item__label"},t.label))})))};function ht(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function dt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vt(){var e=gt(["\n              flex-wrap: nowrap;\n            "]);return vt=function(){return e},e}function yt(){var e=gt(["\n              flex-wrap: nowrap;\n            "]);return yt=function(){return e},e}function gt(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var bt=Object(Se.memo)((function(e){var t=e.queryType,r=e.stepValue,n=e.query,a=e.onChange,o=e.onStepChange,i=e.onQueryTypeChange,u=e.onKeyDownFunc,l=e.datasource;return _e.a.createElement("div",{"aria-label":"Prometheus extra field",className:"gf-form-inline"},_e.a.createElement("div",{"data-testid":"queryTypeField",className:Object(ze.cx)("gf-form explore-input-margin",Object(ze.css)(yt())),"aria-label":"Query type field"},_e.a.createElement(Te.InlineFormLabel,{width:"auto"},"Query type"),_e.a.createElement(Te.RadioButtonGroup,{options:[{value:"range",label:"Range",description:"Run query over a range of time."},{value:"instant",label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used.'},{value:"both",label:"Both",description:"Run an Instant query and a Range query."}],value:t,onChange:i})),_e.a.createElement("div",{"data-testid":"stepField",className:Object(ze.cx)("gf-form",Object(ze.css)(vt())),"aria-label":"Step field"},_e.a.createElement(Te.InlineFormLabel,{width:5,tooltip:"Time units can be used here, for example: 5s, 1m, 3h, 1d, 1y (Default if no unit is specified: s)"},"Step"),_e.a.createElement("input",{type:"text",className:"gf-form-input width-4",placeholder:"auto",onChange:o,onKeyDown:u,value:r})),_e.a.createElement(Ze,{isEnabled:Boolean(n.exemplar),onChange:function(e){return a(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(r),!0).forEach((function(t){dt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},n,{exemplar:e}))},datasource:l}))}));function Ot(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function jt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(r),!0).forEach((function(t){Et(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ot(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Et(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var wt=Object(Se.memo)((function(e){var t=e.range,r=e.query,n=e.data,a=e.datasource,o=e.history,i=e.onChange,u=e.onRunQuery;return Object(Se.useEffect)((function(){void 0===r.exemplar&&i(jt({},r,{exemplar:!0}))}),[r]),_e.a.createElement(He,{datasource:a,query:r,range:t,onRunQuery:u,onChange:i,onBlur:function(){},history:o,data:n,ExtraFieldElement:_e.a.createElement(bt,{queryType:r.range===r.instant?"both":r.instant?"instant":"range",stepValue:r.interval||"",onQueryTypeChange:function(t){var r=e.query;(0,e.onChange)(jt({},r,"instant"===t?{instant:!0,range:!1}:"range"===t?{instant:!1,range:!0}:{instant:!0,range:!0}))},onStepChange:function(t){t.currentTarget.value!==r.interval&&function(t){var r=e.query;(0,e.onChange)(jt({},r,{interval:t}))}(t.currentTarget.value)},onKeyDownFunc:function(e){"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&u()},query:r,onChange:i,datasource:a})})})),xt=r("Wkk1");function Pt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function St(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _t(){var e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n              margin-left: 8px;\n            "]);return _t=function(){return e},e}function Tt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function It(e){var t=e.value,r=e.onChange,n=e.onDelete,a=Tt(Object(Se.useState)(Boolean(t.datasourceUid)),2),o=a[0],i=a[1];return _e.a.createElement("div",{className:"gf-form-group"},_e.a.createElement(Te.InlineField,{label:"Internal link",labelWidth:24},_e.a.createElement(_e.a.Fragment,null,_e.a.createElement(Te.InlineSwitch,{value:o,onChange:function(e){return i(e.currentTarget.checked)}}),_e.a.createElement(Te.Button,{variant:"destructive",title:"Remove link",icon:"times",onClick:function(e){e.preventDefault(),n()},className:Object(ze.css)(_t())}))),o?_e.a.createElement(Te.InlineField,{label:"Data source",labelWidth:24,tooltip:"The data source the exemplar is going to navigate to."},_e.a.createElement(xt.a,{tracing:!0,current:t.datasourceUid,noDefault:!0,onChange:function(e){return r({datasourceUid:e.uid,name:t.name,url:void 0})}})):_e.a.createElement(Te.InlineField,{label:"URL",labelWidth:24,tooltip:"The URL of the trace backend the user would go to see its trace."},_e.a.createElement(Te.Input,{placeholder:"https://example.com/${__value.raw}",spellCheck:!1,width:40,value:t.url,onChange:function(e){return r({datasourceUid:void 0,name:t.name,url:e.currentTarget.value})}})),_e.a.createElement(Te.InlineField,{label:"Label name",labelWidth:24,tooltip:"The name of the field in the labels object that should be used to get the traceID."},_e.a.createElement(Te.Input,{placeholder:"traceID",spellCheck:!1,width:40,value:t.name,onChange:function(e){return r(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Pt(Object(r),!0).forEach((function(t){St(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,{name:e.currentTarget.value}))}})))}function Dt(){var e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n          margin-bottom: 10px;\n        "]);return Dt=function(){return e},e}function kt(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function qt(e){var t=e.options,r=e.onChange;return _e.a.createElement(_e.a.Fragment,null,_e.a.createElement("h3",{className:"page-heading"},"Exemplars"),t&&t.map((function(e,n){return _e.a.createElement(It,{key:n,value:e,onChange:function(e){var a=kt(t);a.splice(n,1,e),r(a)},onDelete:function(){var e=kt(t);e.splice(n,1),r(e)}})})),_e.a.createElement(Te.Button,{variant:"secondary",className:Object(ze.css)(Dt()),icon:"plus",onClick:function(e){e.preventDefault();var n=[].concat(kt(t||[]),[{name:"traceID"}]);r(n)}},"Add"))}function Ct(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Rt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ct(Object(r),!0).forEach((function(t){At(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ct(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function At(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ft=Te.LegacyForms.Select,Qt=Te.LegacyForms.Input,Nt=Te.LegacyForms.FormField,Lt=Te.LegacyForms.Switch,Mt=[{value:"POST",label:"POST"},{value:"GET",label:"GET"}],Ut=function(e){var t,r=e.options,a=e.onOptionsChange;return r.jsonData.httpMethod||(r.url?r.jsonData.httpMethod="GET":r.jsonData.httpMethod="POST"),_e.a.createElement(_e.a.Fragment,null,_e.a.createElement("div",{className:"gf-form-group"},_e.a.createElement("div",{className:"gf-form-inline"},_e.a.createElement("div",{className:"gf-form"},_e.a.createElement(Nt,{label:"Scrape interval",labelWidth:13,inputEl:_e.a.createElement(Qt,{className:"width-6",value:r.jsonData.timeInterval,spellCheck:!1,placeholder:"15s",onChange:Ht("timeInterval",r,a),validationEvents:Vt}),tooltip:"Set this to the typical scrape and evaluation interval configured in Prometheus. Defaults to 15s."}))),_e.a.createElement("div",{className:"gf-form-inline"},_e.a.createElement("div",{className:"gf-form"},_e.a.createElement(Nt,{label:"Query timeout",labelWidth:13,inputEl:_e.a.createElement(Qt,{className:"width-6",value:r.jsonData.queryTimeout,onChange:Ht("queryTimeout",r,a),spellCheck:!1,placeholder:"60s",validationEvents:Vt}),tooltip:"Set the Prometheus query timeout."}))),_e.a.createElement("div",{className:"gf-form"},_e.a.createElement(Te.InlineFormLabel,{width:13,tooltip:"You can use either POST or GET HTTP method to query your Prometheus data source. POST is the recommended method as it allows bigger queries. Change this to GET if you have a Prometheus version older than 2.1 or if POST requests are restricted in your network."},"HTTP Method"),_e.a.createElement(Ft,{options:Mt,value:Mt.find((function(e){return e.value===r.jsonData.httpMethod})),onChange:Ht("httpMethod",r,a),width:7}))),_e.a.createElement("h3",{className:"page-heading"},"Misc"),_e.a.createElement("div",{className:"gf-form-group"},_e.a.createElement("div",{className:"gf-form"},_e.a.createElement(Lt,{checked:null!==(t=r.jsonData.disableMetricsLookup)&&void 0!==t&&t,label:"Disable metrics lookup",labelClass:"width-14",onChange:Object(n.onUpdateDatasourceJsonDataOptionChecked)(e,"disableMetricsLookup"),tooltip:"Checking this option will disable the metrics chooser and metric/label support in the query field's autocomplete. This helps if you have performance issues with bigger Prometheus instances."})),_e.a.createElement("div",{className:"gf-form-inline"},_e.a.createElement("div",{className:"gf-form max-width-30"},_e.a.createElement(Nt,{label:"Custom query parameters",labelWidth:14,tooltip:"Add Custom parameters to all Prometheus or Thanos queries.",inputEl:_e.a.createElement(Qt,{className:"width-25",value:r.jsonData.customQueryParameters,onChange:Ht("customQueryParameters",r,a),spellCheck:!1,placeholder:"Example: max_source_resolution=5m&timeout=10"})})))),_e.a.createElement(qt,{options:r.jsonData.exemplarTraceIdDestinations,onChange:function(e){return Object(n.updateDatasourcePluginJsonDataOption)({onOptionsChange:a,options:r},"exemplarTraceIdDestinations",e)}}))},Vt=At({},Te.EventsWithValidation.onBlur,[Object(Te.regexValidation)(/^$|^\d+(ms|[Mwdhmsy])$/,"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s")]),Bt=function(e){return e?e.hasOwnProperty("currentTarget")?e.currentTarget.value:e.value:""},Ht=function(e,t,r){return function(n){r(Rt({},t,{jsonData:Rt({},t.jsonData,At({},e,Bt(n)))}))}},Gt=r("ZFWI");r.d(t,"plugin",(function(){return zt}));var Wt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stepDefaultValuePlaceholder="60s"};Wt.templateUrl="partials/annotations.editor.html";var zt=new n.DataSourcePlugin(Ee).setQueryEditor(pt).setConfigEditor((function(e){var t=e.options,r=e.onOptionsChange;return _e.a.createElement(_e.a.Fragment,null,_e.a.createElement(Te.DataSourceHttpSettings,{defaultUrl:"http://localhost:9090",dataSourceConfig:t,showAccessOptions:!0,onChange:r,sigV4AuthToggleEnabled:Gt.a.sigV4AuthEnabled}),_e.a.createElement(Ut,{options:t,onOptionsChange:r}))})).setExploreMetricsQueryField(wt).setAnnotationQueryCtrl(Wt).setQueryEditorHelp(mt)},sGFA:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(e){var t=!1;return{promise:new Promise((function(r,n){e.then((function(e){return t?n({isCanceled:!0}):r(e)})),e.catch((function(e){return n(t?{isCanceled:!0}:e)}))})),cancel:function(){t=!0}}}}}]);
//# sourceMappingURL=prometheusPlugin.1c3a1c85d09a392be724.js.map